#!/usr/bin/make -f

DEBIAN_ARCH = $(shell dpkg-architecture -qDEB_BUILD_ARCH)
DEB_HOST_MULTIARCH = $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

export DEB_LDFLAGS_MAINT_APPEND = -Wl,-z,defs -Wl,--as-needed

CC:=ccache $(CC)

%:
	dh $@ --parallel --builddirectory=build --buildsystem=cmake --with quilt

override_dh_auto_configure:
	CC="$(CC)" dh_auto_configure -- \
	-DSHARED:STRING="yes" -DCMAKE_INSTALL_LIBDIR:STRING=$(DEB_HOST_MULTIARCH)

ifeq "$(DEBIAN_ARCH)" "powerpc"
	perl -i -pe 's,HAVE_ALTIVEC:INTERNAL=1,HAVE_ALTIVEC:INTERNAL=0,' build/CMakeCache.txt
endif

override_dh_makeshlibs:
	dh_makeshlibs -V

override_dh_builddeb:
	dh_builddeb -- -Zbzip2
