From: "Matteo F. Vescovi" <mfv.debian@gmail.com>
Date: Sun, 20 May 2012 15:33:57 +0200
Subject: Fix_FTBFS_on_Hurd

---
 src/iv/ivmain.cpp       |    2 +-
 src/libutil/sysutil.cpp |    9 ++++++++-
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/iv/ivmain.cpp b/src/iv/ivmain.cpp
index 9c9e21e..2c9e06d 100644
--- a/src/iv/ivmain.cpp
+++ b/src/iv/ivmain.cpp
@@ -127,7 +127,7 @@ put_in_background (int, char* [])
     // But it suffers from the same problem on OS X, and seems to just be
     // a wrapper for fork.
 
-#ifdef __linux
+#if defined(__linux__) || defined(__GLIBC__)
     // Simplest case:
     daemon (1, 1);
     return true;
diff --git a/src/libutil/sysutil.cpp b/src/libutil/sysutil.cpp
index 3a24c24..9d88cb6 100644
--- a/src/libutil/sysutil.cpp
+++ b/src/libutil/sysutil.cpp
@@ -63,6 +63,11 @@
 # include <sys/resource.h>
 #endif
 
+#ifdef __GNU__
+# include <unistd.h>
+# include <sys/ioctl.h>
+#endif
+
 #include "dassert.h"
 
 #include "sysutil.h"
@@ -165,6 +170,8 @@ Sysutil::this_program_path ()
     size_t cb = sizeof(filename);
     int r=1;
     sysctl(mib, 4, filename, &cb, NULL, 0);
+#elif defined(__GNU__)
+    int r = 0;
 #else
     // No idea what platform this is
     ASSERT (0);
@@ -194,7 +201,7 @@ Sysutil::terminal_columns ()
 {
     int columns = 80;   // a decent guess, if we have nothing more to go on
 
-#if defined(__linux__) || defined(__APPLE__) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
+#if defined(__linux__) || defined(__APPLE__) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(__GNU__)
     struct winsize w;
     ioctl (0, TIOCGWINSZ, &w);
     columns = w.ws_col;
