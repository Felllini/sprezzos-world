#!/bin/sh -e

. /usr/share/debconf/confmodule
VERSION=$2

if [ -e /etc/default/lastmp ]; then
    . /etc/default/lastmp
    if echo "$MPD_HOST" | grep -q "@"; then
        HOST="${MPD_HOST#*@}"
        PASSWORD="${MPD_HOST%@*}"
        db_set lastmp/host "$HOST"
        db_set lastmp/password "$PASSWORD"
    else
        db_set lastmp/host "$MPD_HOST"
        db_set lastmp/password ""
    fi
    db_set lastmp/port "$MPD_PORT"
fi

get_conf() {
    /usr/lib/lastfmsubmitd/conftool --get "$@" /etc/lastmp.conf
}

if [ -e /etc/lastmp.conf ]; then
    db_set lastmp/host $(get_conf mpd/host)
    db_set lastmp/port $(get_conf mpd/port)
    db_set lastmp/password $(get_conf mpd/password)
fi

db_input high lastmp/host || true
db_input high lastmp/port || true
db_input high lastmp/password || true

db_go
