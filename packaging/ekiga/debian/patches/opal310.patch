Author: Mehdi Dogguy <mehdi@debian.org>
Subject: Cope with API changes in Opal 3.10

  http://git.gnome.org/browse/ekiga/commit/lib/engine/components/opal/opal-call.cpp?id=34d9b995344eca38afa083b10a6c864c15848b9a
  http://git.gnome.org/browse/ekiga/commit/lib/engine/components/opal/opal-call.cpp?id=72d7b95bd8df3b6673e175195d9ba2b8abef5c0e
  http://git.gnome.org/browse/ekiga/commit/lib/engine/components/opal/sip-endpoint.cpp?id=8c02582bdfa81ea0154572549fbfc319811a72f1

Origin: upstream
Bug-Debian: http://bugs.debian.org/664929

--- a/lib/engine/components/opal/opal-call.cpp
+++ b/lib/engine/components/opal/opal-call.cpp
@@ -154,11 +154,11 @@
   PSafePtr<OpalConnection> connection = get_remote_connection ();
   if (connection != NULL) {
 
-    on_hold = connection->IsConnectionOnHold ();
+    on_hold = connection->IsOnHold (false);
     if (!on_hold)
-      connection->HoldConnection ();
+      connection->Hold (false, true);
     else
-      connection->RetrieveConnection ();
+      connection->Hold (false, false);
   }
 }
 
@@ -477,7 +477,6 @@
     case OpalConnection::EndedByNoRingBackTone:
     case OpalConnection::EndedByOutOfService:
     case OpalConnection::EndedByAcceptingCallWaiting:
-    case OpalConnection::EndedWithQ931Code:
     case OpalConnection::NumCallEndReasons:
     default :
       reason = _("Call completed");
--- a/lib/engine/components/opal/sip-endpoint.cpp
+++ b/lib/engine/components/opal/sip-endpoint.cpp
@@ -352,7 +352,11 @@
 {
   if (!_uri.empty () && (_uri.find ("sip:") == 0 || _uri.find (':') == string::npos) && !_message.empty ()) {
 
-    SIPEndPoint::Message (_uri, _message);
+    OpalIM im;
+    im.m_to = PURL (_uri);
+    im.m_mimeType = "text/plain;charset=UTF-8";
+    im.m_body = _message;
+    Message(im);
 
     return true;
   }
@@ -940,6 +944,7 @@
 }
 
 
+#if 0
 void
 Opal::Sip::EndPoint::OnMessageFailed (const SIPURL & messageUrl,
 				      SIP_PDU::StatusCodes /*reason*/)
@@ -953,6 +958,7 @@
 					   uri, display_name,
 					   _("Could not send message")));
 }
+#endif
 
 
 SIPURL
--- a/lib/engine/components/opal/sip-endpoint.h
+++ b/lib/engine/components/opal/sip-endpoint.h
@@ -180,8 +180,10 @@
       bool OnReceivedMESSAGE (OpalTransport & transport,
                               SIP_PDU & pdu);
 
+#if 0
       void OnMessageFailed (const SIPURL & messageUrl,
                             SIP_PDU::StatusCodes reason);
+#endif
 
       SIPURL GetRegisteredPartyName (const SIPURL & host,
 				     const OpalTransport & transport);
