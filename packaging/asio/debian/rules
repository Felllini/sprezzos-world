#!/usr/bin/make -f

#export DH_VERBOSE=1

CXXFLAGS = -W -Wall -g -pipe

configure: configure.ac
	aclocal
	automake -a -c
	autoconf

config.status: configure
	dh_testdir
	./configure --prefix=/usr \
	  --enable-maintainer-mode \
	  --mandir=\$${prefix}/share/man \
	  --infodir=\$${prefix}/share/info \
	  CXXFLAGS="$(CXXFLAGS)" \
	  LDFLAGS="-Wl,-z,defs"

ifeq ($(findstring nocheck,$(DEB_BUILD_OPTIONS)),)
all_or_check = check
else
all_or_check = all
endif

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
parallel = -j$(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
endif

build: build-stamp

build-stamp:  config.status
	dh_testdir
	$(MAKE) $(parallel) $(all_or_check)
	touch $@

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp 
	[ ! -f Makefile ] || $(MAKE) maintainer-clean
	$(RM) configure
	dh_clean 

install: build
	dh_testdir
	dh_testroot
	dh_clean -k 
	$(MAKE) DESTDIR=$(CURDIR)/debian/tmp install

binary-indep: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs 
	dh_installdocs
	dh_installexamples
	dh_install
	sed -i -e 's@\(../\)\{1,2\}src/@@g' debian/libasio-doc/usr/share/doc/libasio-doc/asio/examples.html
	find debian/libasio-doc/usr/share/doc/libasio-doc/asio/examples/ -type f -not -name \*.[ch]pp -print0 | xargs -r0 rm
	find debian/libasio-doc/usr/share/doc/libasio-doc/asio/examples/ -depth -type d -empty -exec rmdir {} \;
#	dh_installmenu
#	dh_installdebconf	
#	dh_installlogrotate
#	dh_installemacsen
#	dh_installpam
#	dh_installmime
#	dh_python
#	dh_installinit
#	dh_installcron
#	dh_installinfo
#	dh_installman
	dh_compress -X.cpp -X.hpp
	dh_fixperms
#	dh_perl
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary-arch:

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install 
