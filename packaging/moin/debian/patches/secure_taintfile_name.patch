
# HG changeset patch
# User Thomas Waldmann <tw AT waldmann-edv DOT de>
# Date 1354998024 -3600
# Node ID d3090fb6624f600c64076e161a47207496ad356b
# Parent  20a27e94a7f956b65e342eedaa9436292db407e8
make taintfilename more secure

diff -r 20a27e94a7f9 -r d3090fb6624f MoinMoin/wikiutil.py
--- a/MoinMoin/wikiutil.py	Fri Sep 28 15:04:15 2012 +0200
+++ b/MoinMoin/wikiutil.py	Sat Dec 08 21:20:24 2012 +0100
@@ -2266,9 +2266,9 @@
     @rtype: string
     @return: (safer) filename
     """
-    for x in (os.pardir, ':', '/', '\\', '<', '>'):
-        basename = basename.replace(x, '_')
-
+    # note: filenames containing ../ (or ..\) are made safe by replacing
+    # the / (or the \). the .. will be kept, but is harmless then.
+    basename = re.sub('[\x00-\x1f:/\\\\<>"*?%|]', '_', basename)
     return basename
 
 

