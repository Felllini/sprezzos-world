Description: SpanDSP needs stdint.h
Author: Craig Southeren

backported from upstream revision 26035 (trunk) - somewhat shortened
--- a/opal.m4
+++ b/opal.m4
@@ -915,11 +915,14 @@ AC_DEFUN([OPAL_FIND_SPANDSP],
               ],
               [opal_spandsp=no])
           LIBS=$saved_LIBS
+          saved_CXXFLAGS=$CXXFLAGS
+          CXXFLAGS="$CXXFLAGS -D__STDC_LIMIT_MACROS"
           if test "x${opal_spandsp}" = "xyes"; then
               SPANDSP_LIBS="-lspandsp"
-              AC_CHECK_HEADERS([spandsp.h], [opal_spandsp=yes], [opal_spandsp=no])
+              AC_CHECK_HEADERS([spandsp.h], [opal_spandsp=yes], [opal_spandsp=no], [#include <stdint.h>])
           fi
           AS_IF([test AS_VAR_GET([opal_spandsp]) = yes], [$1], [$2])[]
+          CXXFLAGS=$saved_CXXFLAGS
          ])
 
 
--- a/plugins/configure
+++ b/plugins/configure
@@ -2342,6 +2342,37 @@ fi
   eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
 } # ac_fn_c_check_header_mongrel
+
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval "test \"\${$3+set}\"" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+
+} # ac_fn_c_check_header_compile
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
@@ -10087,11 +10118,14 @@ else
 fi
 
           LIBS=$saved_LIBS
+          saved_CXXFLAGS=$CXXFLAGS
+          CXXFLAGS="$CXXFLAGS -D__STDC_LIMIT_MACROS"
           if test "x${opal_spandsp}" = "xyes"; then
               SPANDSP_LIBS="-lspandsp"
               for ac_header in spandsp.h
 do :
-  ac_fn_c_check_header_mongrel "$LINENO" "spandsp.h" "ac_cv_header_spandsp_h" "$ac_includes_default"
+  ac_fn_c_check_header_compile "$LINENO" "spandsp.h" "ac_cv_header_spandsp_h" "#include <stdint.h>
+"
 if test "x$ac_cv_header_spandsp_h" = x""yes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SPANDSP_H 1
@@ -10109,6 +10143,7 @@ done
 else
   HAVE_SPANDSP=no
 fi
+          CXXFLAGS=$saved_CXXFLAGS
 
   fi
 else
