#!/usr/bin/make -f

pkg := $(shell dpkg-parsechangelog | sed -n 's/^Source: //p')
arch := $(shell dpkg-architecture -qDEB_HOST_ARCH 2>/dev/null | awk -F- '{print $$NF}')

CPPFLAGS := $(shell dpkg-buildflags --get CPPFLAGS)
LDFLAGS := $(shell dpkg-buildflags --get LDFLAGS)
EXTRA_FLAGS := $(LDFLAGS)


# ENABLE_SSE=0
ifeq ($(arch),i386)
    ENABLE_SSE=1
endif
ifeq ($(arch),amd64)
    ENABLE_SSE=1
endif

%:
	dh $@

override_dh_auto_build:
	dh_auto_build -- ENABLE_SSE=$(ENABLE_SSE) EXTRA_FLAGS=$(EXTRA_FLAGS) CPPFLAGS=$(CPPFLAGS)

override_dh_auto_install:
	mkdir -p $(CURDIR)/debian/$(pkg)/usr/share/man/man1/
	help2man --name="wrapper for $(pkg)-align" --no-info \
		$(CURDIR)/$(pkg) > $(CURDIR)/debian/$(pkg)/usr/share/man/man1/$(pkg).1
	help2man --name="building a colorspace index for $(pkg)" --no-info \
		$(CURDIR)/$(pkg)-build > $(CURDIR)/debian/$(pkg)/usr/share/man/man1/$(pkg)-build.1
	help2man --name="extracts information from a $(pkg) index" --no-info \
		$(CURDIR)/$(pkg)-inspect > $(CURDIR)/debian/$(pkg)/usr/share/man/man1/$(pkg)-inspect.1
	help2man --name="ultrafast and memory-efficient tool for aligning sequencing reads to long reference sequences" --no-info \
	    $(CURDIR)/$(pkg)-align> $(CURDIR)/debian/$(pkg)/usr/share/man/man1/$(pkg)-align.1

override_dh_installchangelogs:
	dh_installchangelogs NEWS

get-orig-source:
	. debian/get-orig-source
