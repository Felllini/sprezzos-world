#!/usr/bin/make -f

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

CFLAGS = $(shell dpkg-buildflags --get CFLAGS)
CFLAGS += $(shell dpkg-buildflags --get CPPFLAGS)

CC:=ccache $(CC)

%:
	dh $@ --parallel --with autotools_dev

override_dh_auto_configure:
	cd build/generic && ./configure --prefix=/usr \
	--libdir=\$${prefix}/lib/$(DEB_HOST_MULTIARCH) \
	CC="$(CC)"

override_dh_auto_build:
	cd build/generic && $(MAKE)

override_dh_install:
	$(MAKE) -C build/generic install prefix=$(CURDIR)/debian/tmp/usr

	dh_install --fail-missing

	dh_link -plibxvidcore-dev usr/lib/$(DEB_HOST_MULTIARCH)/libxvidcore.so.4.3 usr/lib/$(DEB_HOST_MULTIARCH)/libxvidcore.so
	dh_link -plibxvidcore4 usr/lib/$(DEB_HOST_MULTIARCH)/libxvidcore.so.4.3 usr/lib/$(DEB_HOST_MULTIARCH)/libxvidcore.so.4

override_dh_builddeb:
	dh_builddeb -- -Zbzip2

override_dh_clean:
	touch build/generic/platform.inc
	cd build/generic && $(MAKE) distclean

	dh_clean
