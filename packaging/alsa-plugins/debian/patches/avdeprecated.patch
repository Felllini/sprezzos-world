Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 alsa-plugins (1.0.26-SprezzOS1) unstable; urgency=low
 .
   * New upstream
Author: Nick Black <nick.black@sprezzatech.com>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: http://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: <YYYY-MM-DD>

--- alsa-plugins-1.0.26.orig/a52/pcm_a52.c
+++ alsa-plugins-1.0.26/a52/pcm_a52.c
@@ -27,6 +27,7 @@
 #include <alsa/pcm_plugin.h>
 #include AVCODEC_HEADER
 #include <libavutil/avutil.h>
+#include <libavutil/channel_layout.h>
 
 struct a52_ctx {
 	snd_pcm_ioplug_t io;
@@ -430,7 +431,7 @@ static int a52_prepare(snd_pcm_ioplug_t
 
 	a52_free(rec);
 
-	rec->avctx = avcodec_alloc_context();
+	rec->avctx = avcodec_alloc_context3(NULL);
 	if (! rec->avctx)
 		return -ENOMEM;
 
@@ -445,20 +446,20 @@ static int a52_prepare(snd_pcm_ioplug_t
 #if LIBAVCODEC_VERSION_MAJOR > 52 || (LIBAVCODEC_VERSION_MAJOR == 52 && LIBAVCODEC_VERSION_MINOR >= 3)
 	switch (io->channels) {
 	case 2:
-		rec->avctx->channel_layout = CH_LAYOUT_STEREO;
+		rec->avctx->channel_layout = AV_CH_LAYOUT_STEREO;
 		break;
 	case 4:
-		rec->avctx->channel_layout = CH_LAYOUT_QUAD;
+		rec->avctx->channel_layout = AV_CH_LAYOUT_QUAD;
 		break;
 	case 6:
-		rec->avctx->channel_layout = CH_LAYOUT_5POINT1;
+		rec->avctx->channel_layout = AV_CH_LAYOUT_5POINT1;
 		break;
 	default:
 		break;
 	}
 #endif
 
-	if (avcodec_open(rec->avctx, rec->codec) < 0)
+	if (avcodec_open2(rec->avctx, rec->codec, NULL) < 0)
 		return -EINVAL;
 
 	rec->inbuf = malloc(rec->avctx->frame_size * 2 * io->channels);
@@ -703,7 +704,6 @@ SND_PCM_PLUGIN_DEFINE_FUNC(a52)
 	rec->channels = channels;
 	rec->format = format;
 
-	avcodec_init();
 	avcodec_register_all();
 
 	rec->codec = avcodec_find_encoder_by_name("ac3_fixed");
