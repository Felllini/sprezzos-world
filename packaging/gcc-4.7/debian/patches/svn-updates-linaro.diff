# DP: updates from the 4.7 branch upto 20121217 (r194553).

last_updated()
{
	cat > ${dir}LAST_UPDATED <<EOF
Mon Dec 17 14:06:40 CET 2012
Mon Dec 17 13:06:40 UTC 2012 (revision 194553)
EOF
}

LANG=C svn diff svn://gcc.gnu.org/svn/gcc/branches/gcc-4_7-branch@194184 svn://gcc.gnu.org/svn/gcc/branches/gcc-4_7-branch \
	| sed -r 's,^--- (\S+)\t(\S+)(.*)$,--- a/src/\1\t\2,;s,^\+\+\+ (\S+)\t(\S+)(.*)$,+++ b/src/\1\t\2,' \
	| awk '/^Index:.*\.(class|texi)/ {skip=1; next} /^Index:/ { skip=0 } skip==0'

Index: libstdc++-v3/src/Makefile.in
===================================================================
--- a/src/libstdc++-v3/src/Makefile.in	(revision
+++ b/src/libstdc++-v3/src/Makefile.in	(revision
@@ -879,7 +879,7 @@
 @ENABLE_SYMVERS_TRUE@	  fi; \
 @ENABLE_SYMVERS_TRUE@	fi
 @ENABLE_SYMVERS_TRUE@	$(EGREP) -v '^[ 	]*#(#| |$$)' $@.tmp | \
-@ENABLE_SYMVERS_TRUE@	  $(CC) -E -P -include ../config.h - > $@ || (rm -f $@ ; exit 1)
+@ENABLE_SYMVERS_TRUE@	  $(CC) -E -P -include $(CONFIG_HEADER) - > $@ || (rm -f $@ ; exit 1)
 @ENABLE_SYMVERS_TRUE@	rm -f $@.tmp
 @ENABLE_SYMVERS_SUN_TRUE@@ENABLE_SYMVERS_TRUE@libstdc++-symbols.ver-sun : libstdc++-symbols.ver \
 @ENABLE_SYMVERS_SUN_TRUE@@ENABLE_SYMVERS_TRUE@		$(toplevel_srcdir)/contrib/make_sunver.pl \
Index: libstdc++-v3/src/Makefile.am
===================================================================
--- a/src/libstdc++-v3/src/Makefile.am	(revision
+++ b/src/libstdc++-v3/src/Makefile.am	(revision
@@ -213,7 +213,7 @@
 	  fi; \
 	fi
 	$(EGREP) -v '^[ 	]*#(#| |$$)' $@.tmp | \
-	  $(CC) -E -P -include ../config.h - > $@ || (rm -f $@ ; exit 1)
+	  $(CC) -E -P -include $(CONFIG_HEADER) - > $@ || (rm -f $@ ; exit 1)
 	rm -f $@.tmp
 
 CLEANFILES = libstdc++-symbols.ver
Index: libstdc++-v3/src/c++11/thread.cc
===================================================================
--- a/src/libstdc++-v3/src/c++11/thread.cc	(revision
+++ b/src/libstdc++-v3/src/c++11/thread.cc	(revision
@@ -1,6 +1,6 @@
 // thread -*- C++ -*-
 
-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.
+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.
 //
 // This file is part of the GNU ISO C++ Library.  This library is free
 // software; you can redistribute it and/or modify it under the
@@ -26,6 +26,7 @@
 #include <thread>
 #include <system_error>
 #include <cerrno>
+#include <cxxabi_forced.h>
 
 #if defined(_GLIBCXX_USE_GET_NPROCS)
 # include <sys/sysinfo.h>
@@ -72,6 +73,10 @@
 	{
 	  __t->_M_run();
 	}
+      __catch(const __cxxabiv1::__forced_unwind&)
+	{
+	  __throw_exception_again;
+	}
       __catch(...)
 	{
 	  std::terminate();
Index: libstdc++-v3/doc/xml/manual/policy_data_structures_biblio.xml
===================================================================
--- a/src/libstdc++-v3/doc/xml/manual/policy_data_structures_biblio.xml	(revision
+++ b/src/libstdc++-v3/doc/xml/manual/policy_data_structures_biblio.xml	(revision
@@ -0,0 +1,1456 @@
+
+ <!-- Policy Based Data Structures: Biblio -->
+ <bibliography xml:id="pbds.biblio">
+    <info>
+      <title>
+	Bibliography
+      </title>
+    </info>
+    <?dbhtml filename="policy_data_structures_biblio.html"?>
+
+    <!-- 01 -->
+    <biblioentry xml:id="biblio.abrahams97exception">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1997/N1075.pdf">
+	  STL Exception Handling Contract
+	</link>
+      </title>
+      <date>1997</date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Dave
+	  </firstname>
+	  <surname>
+	    Abrahams
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  ISO SC22/WG21
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 02 -->
+    <biblioentry xml:id="biblio.alexandrescu01modern">
+      <title>
+	Modern C++ Design: Generic Programming and Design Patterns Applied
+      </title>
+      <date>
+	2001
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Andrei
+	  </firstname>
+	  <surname>
+	    Alexandrescu
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 03 -->
+    <biblioentry xml:id="biblio.andrew04mtf">
+      <title>
+	MTF, Bit, and COMB: A Guide to Deterministic and Randomized
+	Algorithms for the List Update Problem
+      </title>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      K.
+	    </firstname>
+	    <surname>
+	      Andrew
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Gleich
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+    </biblioentry>
+
+    <!-- 04 -->
+    <biblioentry xml:id="biblio.austern00noset">
+      <title>
+	Why You Shouldn't Use set - and What You Should Use Instead
+      </title>
+      <date>
+	April, 2000
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Matthew
+	  </firstname>
+	  <surname>
+	    Austern
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  C++ Report
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 05 -->
+    <biblioentry xml:id="biblio.austern01htprop">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.open-std.org/JTC1/sc22/wg21/docs/papers/2001/n1326.html">
+	  A Proposal to Add Hashtables to the Standard Library
+	</link>
+      </title>
+      <date>
+	2001
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Matthew
+	  </firstname>
+	  <surname>
+	    Austern
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  ISO SC22/WG21
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 06 -->
+    <biblioentry xml:id="biblio.austern98segmentedit">
+      <title>
+	Segmented iterators and hierarchical algorithms
+      </title>
+      <date>
+	April, 1998
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Matthew
+	  </firstname>
+	  <surname>
+	    Austern
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Generic Programming
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 07 -->
+    <biblioentry xml:id="biblio.dawestimer">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="www.boost.org/doc/libs/release/libs/timer/">
+	  Boost Timer Library
+	</link>
+      </title>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Beeman
+	  </firstname>
+	  <surname>
+	    Dawes
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Boost
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 08 -->
+    <biblioentry xml:id="biblio.clearypool">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="www.boost.org/doc/libs/release/libs/pool/">
+	  Boost Pool Library
+	</link>
+      </title>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Stephen
+	  </firstname>
+	  <surname>
+	    Cleary
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Boost
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 09 -->
+    <biblioentry xml:id="biblio.maddocktraits">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="www.boost.org/doc/libs/release/libs/type_traits/">
+	  Boost Type Traits Library
+	</link>
+      </title>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      Maddock
+	    </firstname>
+	    <surname>
+	      John
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      Stephen
+	    </firstname>
+	    <surname>
+	      Cleary
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  Boost
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 10 -->
+    <biblioentry xml:id="biblio.brodal96priority">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="https://dl.acm.org/citation.cfm?id=313883">
+	  Worst-case efficient priority queues
+	</link>
+      </title>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Gerth
+	  </firstname>
+	  <surname>
+	    Stolting Brodal
+	  </surname>
+	</personname>
+      </author>
+
+    </biblioentry>
+
+    <!-- 11 -->
+    <biblioentry xml:id="biblio.bulkamayheweff">
+      <title>
+	Efficient C++ Programming Techniques
+      </title>
+      <date>
+	1997
+      </date>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Bulka
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Mayhew
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 12 -->
+    <biblioentry xml:id="biblio.clrs2001">
+      <title>
+	Introduction to Algorithms, 2nd edition
+      </title>
+      <date>
+	2001
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      T. H.
+	    </firstname>
+	    <surname>
+	      Cormen
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      C. E.
+	    </firstname>
+	    <surname>
+	      Leiserson
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      R. L.
+	    </firstname>
+	    <surname>
+	      Rivest
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      C.
+	    </firstname>
+	    <surname>
+	      Stein
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  MIT Press
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 13 -->
+    <biblioentry xml:id="biblio.dubhashi98neg">
+      <title>
+	Balls and bins: A study in negative dependence
+      </title>
+      <date>
+	1998
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Dubashi
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Ranjan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  Random Structures and Algorithms 13
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 14 -->
+    <biblioentry xml:id="biblio.fagin79extendible">
+      <title>
+	Extendible hashing - a fast access method for dynamic files
+      </title>
+      <date>
+	1979
+      </date>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      R.
+	    </firstname>
+	    <surname>
+	      Fagin
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      J.
+	    </firstname>
+	    <surname>
+	      Nievergelt
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      N.
+	    </firstname>
+	    <surname>
+	      Pippenger
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      H. R.
+	    </firstname>
+	    <surname>
+	      Strong
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  ACM Trans. Database Syst. 4
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+
+    <!-- 15 -->
+    <biblioentry xml:id="biblio.filliatre2000ptset">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://cristal.inria.fr/~frisch/icfp06_contest/advtr/applyOmatic/ptset.ml">
+	  Ptset: Sets of integers implemented as Patricia trees
+	</link>
+      </title>
+
+      <date>
+	2000
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Jean-Christophe
+	  </firstname>
+	  <surname>
+	    Filliatre
+	  </surname>
+	</personname>
+      </author>
+    </biblioentry>
+
+
+
+    <!-- 16 -->
+    <biblioentry xml:id="biblio.fredman86pairing">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.cs.cmu.edu/~sleator/papers/pairing-heaps.pdf">
+	  The pairing heap: a new form of self-adjusting heap
+	</link>
+      </title>
+      <date>
+	1986
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      M. L.
+	    </firstname>
+	    <surname>
+	      Fredman
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      R.
+	    </firstname>
+	    <surname>
+	      Sedgewick
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      D. D.
+	    </firstname>
+	    <surname>
+	      Sleator
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      R. E.
+	    </firstname>
+	    <surname>
+	      Tarjan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+    </biblioentry>
+
+
+    <!-- 17 -->
+    <biblioentry xml:id="biblio.gof">
+      <title>
+	Design Patterns - Elements of Reusable Object-Oriented Software
+      </title>
+      <date>
+	1995
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      E.
+	    </firstname>
+	    <surname>
+	      Gamma
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      R.
+	    </firstname>
+	    <surname>
+	      Helm
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      R.
+	    </firstname>
+	    <surname>
+	      Johnson
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      J.
+	    </firstname>
+	    <surname>
+	      Vlissides
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 18 -->
+    <biblioentry xml:id="biblio.garg86order">
+      <title>
+	Order-preserving key transformations
+      </title>
+      <date>
+	1986
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      A. K.
+	    </firstname>
+	    <surname>
+	      Garg
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      C. C.
+	    </firstname>
+	    <surname>
+	      Gotlieb
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  Trans. Database Syst. 11
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 19 -->
+    <biblioentry xml:id="biblio.hyslop02making">
+      <title>
+	Making a real hash of things
+      </title>
+      <date>
+	May 2002
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      J.
+	    </firstname>
+	    <surname>
+	      Hyslop
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      Herb
+	    </firstname>
+	    <surname>
+	      Sutter
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  C++ Report
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 20 -->
+    <biblioentry xml:id="biblio.jossutis01stl">
+      <title>
+	The C++ Standard Library - A Tutorial and Reference
+      </title>
+      <date>
+	2001
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    N. M.
+	  </firstname>
+	  <surname>
+	    Jossutis
+	  </surname>
+	</personname>
+      </author>
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 21 -->
+    <biblioentry xml:id="biblio.kt99fat_heaps">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.cs.princeton.edu/research/techreps/TR-597-99">
+	  New Heap Data Structures
+	</link>
+      </title>
+      <date>
+	1999
+      </date>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      Haim
+	    </firstname>
+	    <surname>
+	      Kaplan
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      Robert E.
+	    </firstname>
+	    <surname>
+	      Tarjan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+    </biblioentry>
+
+
+    <!-- 22 -->
+    <biblioentry xml:id="biblio.kleft00sets">
+      <title>
+	Are Set Iterators Mutable or Immutable?
+      </title>
+      <date>
+	October 2000
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      Angelika
+	    </firstname>
+	    <surname>
+	      Langer
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      Klaus
+	    </firstname>
+	    <surname>
+	      Kleft
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  C/C++ Users Jornal
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 23 -->
+    <biblioentry xml:id="biblio.knuth98sorting">
+      <title>
+	The Art of Computer Programming - Sorting and Searching
+      </title>
+      <date>
+	1998
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    D. E.
+	  </firstname>
+	  <surname>
+	    Knuth
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 24 -->
+    <biblioentry xml:id="biblio.liskov98data">
+      <title>
+	Data abstraction and hierarchy
+      </title>
+      <date>
+	May 1998
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    B.
+	  </firstname>
+	  <surname>
+	    Liskov
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  SIGPLAN Notices 23
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 25 -->
+    <biblioentry xml:id="biblio.litwin80lh">
+      <title>
+	Linear hashing: A new tool for file and table addressing
+      </title>
+      <date>
+	June 1980
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    W.
+	  </firstname>
+	  <surname>
+	    Litwin
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Proceedings of International Conference on Very Large Data Bases
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 26 -->
+    <biblioentry xml:id="biblio.maverik_lowerbounds">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://magic.aladdin.cs.cmu.edu/2005/08/01/deamortization-part-2-binomial-heaps">
+	  Deamortization - Part 2: Binomial Heaps
+	</link>
+      </title>
+      <date>
+	2005
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Maverik
+	  </firstname>
+	  <surname>
+	    Woo
+	  </surname>
+	</personname>
+      </author>
+    </biblioentry>
+
+    <!-- 27 -->
+    <biblioentry xml:id="biblio.meyers96more">
+      <title>
+	More Effective C++: 35 New Ways to Improve Your Programs and Designs
+      </title>
+      <date>
+	1996
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Scott
+	  </firstname>
+	  <surname>
+	    Meyers
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 28 -->
+    <biblioentry xml:id="biblio.meyers00nonmember">
+      <title>
+	How Non-Member Functions Improve Encapsulation
+      </title>
+      <date>
+	2000
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Scott
+	  </firstname>
+	  <surname>
+	    Meyers
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  C/C++ Users Journal
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 29 -->
+    <biblioentry xml:id="biblio.meyers01stl">
+      <title>
+	Effective STL: 50 Specific Ways to Improve Your Use of the Standard Template Library
+      </title>
+      <date>
+	2001
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Scott
+	  </firstname>
+	  <surname>
+	    Meyers
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 30 -->
+    <biblioentry xml:id="biblio.meyers02both">
+      <title>
+	Class Template, Member Template - or Both?
+      </title>
+      <date>
+	2003
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Scott
+	  </firstname>
+	  <surname>
+	    Meyers
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  C/C++ Users Journal
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 31 -->
+    <biblioentry xml:id="biblio.motwani95random">
+      <title>
+	Randomized Algorithms
+      </title>
+      <date>
+	2003
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      R.
+	    </firstname>
+	    <surname>
+	      Motwani
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      P.
+	    </firstname>
+	    <surname>
+	      Raghavan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  Cambridge University Press
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 32 -->
+    <biblioentry xml:id="biblio.mscom">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="https://www.microsoft.com/com/">
+	  COM: Component Model Object Technologies
+	</link>
+      </title>
+      <publisher>
+	<publishername>
+	  Microsoft
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 33 -->
+    <biblioentry xml:id="biblio.musser95rationale">
+      <title>
+	Rationale for Adding Hash Tables to the C++ Standard Template Library
+      </title>
+      <date>
+	1995
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    David R.
+	  </firstname>
+	  <surname>
+	    Musser
+	  </surname>
+	</personname>
+      </author>
+
+    </biblioentry>
+
+    <!-- 35 -->
+    <biblioentry xml:id="biblio.musser96stltutorial">
+      <title>
+	STL Tutorial and Reference Guide
+      </title>
+      <date>
+	1996
+      </date>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      David R.
+	    </firstname>
+	    <surname>
+	      Musser
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      A.
+	    </firstname>
+	    <surname>
+	      Saini
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+
+    </biblioentry>
+
+
+    <!-- 36 -->
+    <biblioentry xml:id="biblio.nelson96stlpq">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.dogma.net/markn/articles/pq_stl/priority.htm">Priority Queues and the STL
+	</link>
+      </title>
+      <date>
+	January 1996
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Mark
+	  </firstname>
+	  <surname>
+	    Nelson
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Dr. Dobbs Journal
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 37 -->
+    <biblioentry xml:id="biblio.okasaki98mereable">
+      <title>
+	Fast mergeable integer maps
+      </title>
+      <date>
+	September 1998
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      C.
+	    </firstname>
+	    <surname>
+	      Okasaki
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      A.
+	    </firstname>
+	    <surname>
+	      Gill
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  In Workshop on ML
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 38 -->
+    <biblioentry xml:id="biblio.sgi_stl">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://www.sgi.com/tech/stl/">
+	  Standard Template Library Programmer's Guide
+	</link>
+      </title>
+      <author>
+	<personname>
+	  <firstname>
+	    Matt
+	  </firstname>
+	  <surname>
+	    Austern
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  SGI
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 39 -->
+    <biblioentry xml:id="biblio.select_man">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/select.html">
+	  select
+	</link>
+      </title>
+    </biblioentry>
+
+
+    <!-- 40 -->
+    <biblioentry xml:id="biblio.sleator84amortized">
+      <title>
+	Amortized Efficiency of List Update Problems
+      </title>
+      <date>
+	1984
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      D. D.
+	    </firstname>
+	    <surname>
+	      Sleator
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      R. E.
+	    </firstname>
+	    <surname>
+	      Tarjan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  ACM Symposium on Theory of Computing
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 41 -->
+    <biblioentry xml:id="biblio.sleator85self">
+      <title>
+	Self-Adjusting Binary Search Trees
+      </title>
+      <date>
+	1985
+      </date>
+
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      D. D.
+	    </firstname>
+	    <surname>
+	      Sleator
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      R. E.
+	    </firstname>
+	    <surname>
+	      Tarjan
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+
+      <publisher>
+	<publishername>
+	  ACM Symposium on Theory of Computing
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 42 -->
+    <biblioentry xml:id="biblio.stepanov94standard">
+      <title>
+	The Standard Template Library
+      </title>
+      <date>
+	1984
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      A. A.
+	    </firstname>
+	    <surname>
+	      Stepanov
+	    </surname>
+	  </personname>
+	</author>
+	<author>
+	  <personname>
+	    <firstname>
+	      M.
+	    </firstname>
+	    <surname>
+	      Lee
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+    </biblioentry>
+
+    <!-- 43 -->
+    <biblioentry xml:id="biblio.stroustrup97cpp">
+      <title>
+	The C++ Programming Langugage
+      </title>
+      <date>
+	1997
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    Bjarne
+	  </firstname>
+	  <surname>
+	    Stroustrup
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+    <!-- 44 -->
+    <biblioentry xml:id="biblio.vandevoorde2002cpptemplates">
+      <title>
+	C++ Templates: The Complete Guide
+      </title>
+      <date>
+	2002
+      </date>
+      <authorgroup>
+	<author>
+	  <personname>
+	    <firstname>
+	      D.
+	    </firstname>
+	    <surname>
+	      Vandevoorde
+	    </surname>
+	  </personname>
+	</author>
+
+	<author>
+	  <personname>
+	    <firstname>
+	      N. M.
+	    </firstname>
+	    <surname>
+	      Josuttis
+	    </surname>
+	  </personname>
+	</author>
+      </authorgroup>
+      <publisher>
+	<publishername>
+	  Addison-Wesley Publishing Company
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+
+    <!-- 45 -->
+    <biblioentry xml:id="biblio.wickland96thirty">
+      <title>
+	<link xmlns:xlink="http://www.w3.org/1999/xlink"
+	      xlink:href="http://myweb.wvnet.edu/~gsa00121/books/amongdead30.zip">
+	  Thirty Years Among the Dead
+	</link>
+      </title>
+      <date>
+	1996
+      </date>
+
+      <author>
+	<personname>
+	  <firstname>
+	    C. A.
+	  </firstname>
+	  <surname>
+	    Wickland
+	  </surname>
+	</personname>
+      </author>
+
+      <publisher>
+	<publishername>
+	  National Psychological Institute
+	</publishername>
+      </publisher>
+    </biblioentry>
+
+</bibliography>
Index: libstdc++-v3/doc/xml/manual/build_hacking.xml
===================================================================
--- a/src/libstdc++-v3/doc/xml/manual/build_hacking.xml	(revision
+++ b/src/libstdc++-v3/doc/xml/manual/build_hacking.xml	(revision
@@ -270,15 +270,15 @@
 
 
   <para>
-    All the GLIBCXX_ENABLE_FOO macros use a common helper,
-    GLIBCXX_ENABLE.  (You don't have to use it, but it's easy.)  The
-    helper does two things for us:
+    All the <literal>GLIBCXX_ENABLE_FOO</literal> macros use a common
+    helper, <literal>GLIBCXX_ENABLE</literal>.  (You don't have to use
+    it, but it's easy.)  The helper does two things for us:
   </para>
 
 <orderedlist>
  <listitem>
    <para>
-     Builds the call to the AC_ARG_ENABLE macro, with --help text
+     Builds the call to the <literal>AC_ARG_ENABLE</literal> macro, with --help text
      properly quoted and aligned.  (Death to changequote!)
    </para>
  </listitem>
@@ -286,7 +286,7 @@
    <para>
      Checks the result against a list of allowed possibilities, and
      signals a fatal error if there's no match.  This means that the
-     rest of the GLIBCXX_ENABLE_FOO macro doesn't need to test for
+     rest of the <literal>GLIBCXX_ENABLE_FOO</literal> macro doesn't need to test for
      strange arguments, nor do we need to protect against
      empty/whitespace strings with the <code>"x$foo" = "xbar"</code>
      idiom.
@@ -333,13 +333,13 @@
      not pass --enable/--disable.  It should be one of the permitted
      values passed later.  Examples: <code>[yes]</code>, or
      <code>[bar]</code>, or <code>[$1]</code> (which passes the
-     argument given to the GLIBCXX_ENABLE_FOO macro as the
-     default).
+     argument given to the <literal>GLIBCXX_ENABLE_FOO</literal> macro
+     as the default).
    </para>
    <para>
      For cases where we need to probe for particular models of things,
      it is useful to have an undocumented "auto" value here (see
-     GLIBCXX_ENABLE_CLOCALE for an example).
+     <literal>GLIBCXX_ENABLE_CLOCALE</literal> for an example).
    </para>
  </listitem>
  <listitem>
Index: libstdc++-v3/doc/xml/manual/test_policy_data_structures.xml
===================================================================
--- a/src/libstdc++-v3/doc/xml/manual/test_policy_data_structures.xml	(revision
+++ b/src/libstdc++-v3/doc/xml/manual/test_policy_data_structures.xml	(revision
@@ -35,7 +35,8 @@
     several sources, each checking only some containers.</para>
 
     <para>For more details, consult the files in
-    <filename>testsuite/ext/pb_ds/regression</filename>.</para>
+    <filename class="directory">testsuite/ext/pb_ds/regression</filename>.
+    </para>
   </section>
 
   <!-- S02 performance -->
@@ -68,16 +69,12 @@
 	  the number of values inserted.</para>
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/text_find_timing_test.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/text_find_timing_test.cc</filename>
 	  </para>
 
 	  <para>
 	    And uses the data file:
-	    <filename>
-	      filethirty_years_among_the_dead_preproc.txt
-	    </filename>
+	    <filename>filethirty_years_among_the_dead_preproc.txt</filename>
 	  </para>
 
 	  <para>The test checks the effect of different range-hashing
@@ -398,9 +395,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/random_int_find_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/random_int_find_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying
@@ -917,9 +912,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/random_int_subscript_find_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/random_int_subscript_find_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying
@@ -1416,9 +1409,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/random_int_subscript_insert_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/random_int_subscript_insert_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying
@@ -1955,9 +1946,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/hash_zlob_random_int_find_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/hash_zlob_random_int_find_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different range-hashing
@@ -2254,9 +2243,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/hash_random_int_erase_mem_usage.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/hash_random_int_erase_mem_usage.cc</filename>
 	  </para>
 
 
@@ -2536,9 +2523,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/tree_text_insert_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/tree_text_insert_timing.cc</filename>
 	  </para>
 
 
@@ -2912,9 +2897,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/text_find_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/text_find_timing.cc</filename>
 	  </para>
 
 
@@ -3185,9 +3168,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/tree_text_lor_find_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/tree_text_lor_find_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying
@@ -3424,9 +3405,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/tree_split_join_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/tree_split_join_timing.cc</filename>
 	  </para>
 
 
@@ -3688,9 +3667,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/tree_order_statistics_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/tree_order_statistics_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the performance difference of policies based
@@ -3885,9 +3862,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_find_timing_small.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_find_timing_small.cc</filename>
 	  </para>
 
 	  <para>The test checks the find-time scalability of different
@@ -4350,9 +4325,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_find_timing_large.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_find_timing_large.cc</filename>
 	  </para>
 
 	  <para>The test checks the find-time scalability of different
@@ -4819,9 +4792,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_insert_timing_small.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_insert_timing_small.cc</filename>
 	  </para>
 
 	  <para>The test checks the insert-time scalability of different
@@ -5288,9 +5259,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_insert_timing_large.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_insert_timing_large.cc</filename>
 	  </para>
 
 	  <para>The test checks the insert-time scalability of different
@@ -5751,9 +5720,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_insert_mem_usage_small.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_insert_mem_usage_small.cc</filename>
 	  </para>
 
 	  <para>The test checks the memory scalability of different
@@ -6213,9 +6180,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/multimap_text_insert_mem_usage_large.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/multimap_text_insert_mem_usage_large.cc</filename>
 	  </para>
 
 	  <para>The test checks the memory scalability of different
@@ -6675,9 +6640,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_push_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_push_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -7062,9 +7025,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_push_pop_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_push_pop_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -7429,9 +7390,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_random_int_push_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_random_int_push_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -7785,9 +7744,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_random_int_push_pop_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_random_int_push_pop_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -8050,9 +8007,7 @@
 	  number of values pushed to the container.</para>
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_pop_mem_usage.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_pop_mem_usage.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -8302,9 +8257,7 @@
 	  the average time as a function of the number of values.</para>
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_join_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_join_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -8554,9 +8507,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_modify_up_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_modify_up_timing.cc</filename>
 	  </para>
 
 	  <para>The test checks the effect of different underlying data
@@ -8920,9 +8871,7 @@
 
 	  <para>
 	    It uses the test file:
-	    <filename>
-	      performance/ext/pb_ds/priority_queue_text_modify_down_timing.cc
-	    </filename>
+	    <filename>performance/ext/pb_ds/priority_queue_text_modify_down_timing.cc</filename>
 	  </para>
 
 	  <para>The main purpose of this test is to contrast Priority Queue
@@ -9771,4 +9720,4 @@
 
   </section> <!-- performance -->
 
-</section>
\ No newline at end of file
+</section>
Index: libstdc++-v3/doc/xml/manual/policy_data_structures.xml
===================================================================
--- a/src/libstdc++-v3/doc/xml/manual/policy_data_structures.xml	(revision
+++ b/src/libstdc++-v3/doc/xml/manual/policy_data_structures.xml	(revision
@@ -4996,7 +4996,7 @@
 	    <mediaobject>
 	      <imageobject>
 		<imagedata align="center" format="PNG" scale="100"
-			   fileref="../images/pbds_priority_queue_tag_hierarchy.png"/>
+                 fileref="../images/pbds_priority_queue_tag_hierarchy.png"/>
 	      </imageobject>
 	      <textobject>
 		<phrase>Priority-Queue Data-Structure Tags.</phrase>
@@ -5073,7 +5073,6 @@
   <!-- S05: Reference/Acknowledgments -->
   <section xml:id="pbds.ack">
     <info><title>Acknowledgments</title></info>
-    <?dbhtml filename="policy_data_structures_biblio.html"?>
 
     <para>
       Written by Ami Tavory and Vladimir Dreizin (IBM Haifa Research
@@ -5123,1461 +5122,8 @@
     include tries.</para>
   </section>
 
-  <!-- S06: Biblio -->
-  <bibliography xml:id="pbds.biblio">
-    <info>
-      <title>
-	Bibliography
-      </title>
-    </info>
-    <?dbhtml filename="policy_data_structures_biblio.html"?>
+<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="xml"
+	    href="policy_data_structures_biblio.xml">
+</xi:include>
 
-    <!-- 01 -->
-    <biblioentry xml:id="biblio.abrahams97exception">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1997/N1075.pdf">
-	  STL Exception Handling Contract
-	</link>
-      </title>
-      <date>1997</date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Dave
-	  </firstname>
-	  <surname>
-	    Abrahams
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  ISO SC22/WG21
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 02 -->
-    <biblioentry xml:id="biblio.alexandrescu01modern">
-      <title>
-	Modern C++ Design: Generic Programming and Design Patterns Applied
-      </title>
-      <date>
-	2001
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Andrei
-	  </firstname>
-	  <surname>
-	    Alexandrescu
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 03 -->
-    <biblioentry xml:id="biblio.andrew04mtf">
-      <title>
-	MTF, Bit, and COMB: A Guide to Deterministic and Randomized
-	Algorithms for the List Update Problem
-      </title>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      K.
-	    </firstname>
-	    <surname>
-	      Andrew
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Gleich
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-    </biblioentry>
-
-    <!-- 04 -->
-    <biblioentry xml:id="biblio.austern00noset">
-      <title>
-	Why You Shouldn't Use set - and What You Should Use Instead
-      </title>
-      <date>
-	April, 2000
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Matthew
-	  </firstname>
-	  <surname>
-	    Austern
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  C++ Report
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 05 -->
-    <biblioentry xml:id="biblio.austern01htprop">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.open-std.org/JTC1/sc22/wg21/docs/papers/2001/n1326.html">
-	  A Proposal to Add Hashtables to the Standard Library
-	</link>
-      </title>
-      <date>
-	2001
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Matthew
-	  </firstname>
-	  <surname>
-	    Austern
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  ISO SC22/WG21
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 06 -->
-    <biblioentry xml:id="biblio.austern98segmentedit">
-      <title>
-	Segmented iterators and hierarchical algorithms
-      </title>
-      <date>
-	April, 1998
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Matthew
-	  </firstname>
-	  <surname>
-	    Austern
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Generic Programming
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 07 -->
-    <biblioentry xml:id="biblio.dawestimer">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="www.boost.org/doc/libs/release/libs/timer/">
-	  Boost Timer Library
-	</link>
-      </title>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Beeman
-	  </firstname>
-	  <surname>
-	    Dawes
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Boost
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 08 -->
-    <biblioentry xml:id="biblio.clearypool">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="www.boost.org/doc/libs/release/libs/pool/">
-	  Boost Pool Library
-	</link>
-      </title>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Stephen
-	  </firstname>
-	  <surname>
-	    Cleary
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Boost
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 09 -->
-    <biblioentry xml:id="biblio.maddocktraits">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="www.boost.org/doc/libs/release/libs/type_traits/">
-	  Boost Type Traits Library
-	</link>
-      </title>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      Maddock
-	    </firstname>
-	    <surname>
-	      John
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      Stephen
-	    </firstname>
-	    <surname>
-	      Cleary
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  Boost
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 10 -->
-    <biblioentry xml:id="biblio.brodal96priority">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://portal.acm.org/citation.cfm?id=313883">
-	  Worst-case efficient priority queues
-	</link>
-      </title>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Gerth
-	  </firstname>
-	  <surname>
-	    Stolting Brodal
-	  </surname>
-	</personname>
-      </author>
-
-    </biblioentry>
-
-    <!-- 11 -->
-    <biblioentry xml:id="biblio.bulkamayheweff">
-      <title>
-	Efficient C++ Programming Techniques
-      </title>
-      <date>
-	1997
-      </date>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Bulka
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Mayhew
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 12 -->
-    <biblioentry xml:id="biblio.clrs2001">
-      <title>
-	Introduction to Algorithms, 2nd edition
-      </title>
-      <date>
-	2001
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      T. H.
-	    </firstname>
-	    <surname>
-	      Cormen
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      C. E.
-	    </firstname>
-	    <surname>
-	      Leiserson
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      R. L.
-	    </firstname>
-	    <surname>
-	      Rivest
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      C.
-	    </firstname>
-	    <surname>
-	      Stein
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  MIT Press
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 13 -->
-    <biblioentry xml:id="biblio.dubhashi98neg">
-      <title>
-	Balls and bins: A study in negative dependence
-      </title>
-      <date>
-	1998
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Dubashi
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Ranjan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  Random Structures and Algorithms 13
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 14 -->
-    <biblioentry xml:id="biblio.fagin79extendible">
-      <title>
-	Extendible hashing - a fast access method for dynamic files
-      </title>
-      <date>
-	1979
-      </date>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      R.
-	    </firstname>
-	    <surname>
-	      Fagin
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      J.
-	    </firstname>
-	    <surname>
-	      Nievergelt
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      N.
-	    </firstname>
-	    <surname>
-	      Pippenger
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      H. R.
-	    </firstname>
-	    <surname>
-	      Strong
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  ACM Trans. Database Syst. 4
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-
-    <!-- 15 -->
-    <biblioentry xml:id="biblio.filliatre2000ptset">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://cristal.inria.fr/~frisch/icfp06_contest/advtr/applyOmatic/ptset.ml">
-	  Ptset: Sets of integers implemented as Patricia trees
-	</link>
-      </title>
-
-      <date>
-	2000
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Jean-Christophe
-	  </firstname>
-	  <surname>
-	    Filliatre
-	  </surname>
-	</personname>
-      </author>
-    </biblioentry>
-
-
-
-    <!-- 16 -->
-    <biblioentry xml:id="biblio.fredman86pairing">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.cs.cmu.edu/~sleator/papers/pairing-heaps.pdf">
-	  The pairing heap: a new form of self-adjusting heap
-	</link>
-      </title>
-      <date>
-	1986
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      M. L.
-	    </firstname>
-	    <surname>
-	      Fredman
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      R.
-	    </firstname>
-	    <surname>
-	      Sedgewick
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      D. D.
-	    </firstname>
-	    <surname>
-	      Sleator
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      R. E.
-	    </firstname>
-	    <surname>
-	      Tarjan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-    </biblioentry>
-
-
-    <!-- 17 -->
-    <biblioentry xml:id="biblio.gof">
-      <title>
-	Design Patterns - Elements of Reusable Object-Oriented Software
-      </title>
-      <date>
-	1995
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      E.
-	    </firstname>
-	    <surname>
-	      Gamma
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      R.
-	    </firstname>
-	    <surname>
-	      Helm
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      R.
-	    </firstname>
-	    <surname>
-	      Johnson
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      J.
-	    </firstname>
-	    <surname>
-	      Vlissides
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 18 -->
-    <biblioentry xml:id="biblio.garg86order">
-      <title>
-	Order-preserving key transformations
-      </title>
-      <date>
-	1986
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      A. K.
-	    </firstname>
-	    <surname>
-	      Garg
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      C. C.
-	    </firstname>
-	    <surname>
-	      Gotlieb
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  Trans. Database Syst. 11
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 19 -->
-    <biblioentry xml:id="biblio.hyslop02making">
-      <title>
-	Making a real hash of things
-      </title>
-      <date>
-	May 2002
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      J.
-	    </firstname>
-	    <surname>
-	      Hyslop
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      Herb
-	    </firstname>
-	    <surname>
-	      Sutter
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  C++ Report
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 20 -->
-    <biblioentry xml:id="biblio.jossutis01stl">
-      <title>
-	The C++ Standard Library - A Tutorial and Reference
-      </title>
-      <date>
-	2001
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    N. M.
-	  </firstname>
-	  <surname>
-	    Jossutis
-	  </surname>
-	</personname>
-      </author>
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 21 -->
-    <biblioentry xml:id="biblio.kt99fat_heaps">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.cs.princeton.edu/research/techreps/TR-597-99">
-	  New Heap Data Structures
-	</link>
-      </title>
-      <date>
-	1999
-      </date>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      Haim
-	    </firstname>
-	    <surname>
-	      Kaplan
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      Robert E.
-	    </firstname>
-	    <surname>
-	      Tarjan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-    </biblioentry>
-
-
-    <!-- 22 -->
-    <biblioentry xml:id="biblio.kleft00sets">
-      <title>
-	Are Set Iterators Mutable or Immutable?
-      </title>
-      <date>
-	October 2000
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      Angelika
-	    </firstname>
-	    <surname>
-	      Langer
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      Klaus
-	    </firstname>
-	    <surname>
-	      Kleft
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  C/C++ Users Jornal
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 23 -->
-    <biblioentry xml:id="biblio.knuth98sorting">
-      <title>
-	The Art of Computer Programming - Sorting and Searching
-      </title>
-      <date>
-	1998
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    D. E.
-	  </firstname>
-	  <surname>
-	    Knuth
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 24 -->
-    <biblioentry xml:id="biblio.liskov98data">
-      <title>
-	Data abstraction and hierarchy
-      </title>
-      <date>
-	May 1998
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    B.
-	  </firstname>
-	  <surname>
-	    Liskov
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  SIGPLAN Notices 23
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 25 -->
-    <biblioentry xml:id="biblio.litwin80lh">
-      <title>
-	Linear hashing: A new tool for file and table addressing
-      </title>
-      <date>
-	June 1980
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    W.
-	  </firstname>
-	  <surname>
-	    Litwin
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Proceedings of International Conference on Very Large Data Bases
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 26 -->
-    <biblioentry xml:id="biblio.maverik_lowerbounds">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://magic.aladdin.cs.cmu.edu/2005/08/01/deamortization-part-2-binomial-heaps">
-	  Deamortization - Part 2: Binomial Heaps
-	</link>
-      </title>
-      <date>
-	2005
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Maverik
-	  </firstname>
-	  <surname>
-	    Woo
-	  </surname>
-	</personname>
-      </author>
-    </biblioentry>
-
-    <!-- 27 -->
-    <biblioentry xml:id="biblio.meyers96more">
-      <title>
-	More Effective C++: 35 New Ways to Improve Your Programs and Designs
-      </title>
-      <date>
-	1996
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Scott
-	  </firstname>
-	  <surname>
-	    Meyers
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 28 -->
-    <biblioentry xml:id="biblio.meyers00nonmember">
-      <title>
-	How Non-Member Functions Improve Encapsulation
-      </title>
-      <date>
-	2000
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Scott
-	  </firstname>
-	  <surname>
-	    Meyers
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  C/C++ Users Journal
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 29 -->
-    <biblioentry xml:id="biblio.meyers01stl">
-      <title>
-	Effective STL: 50 Specific Ways to Improve Your Use of the Standard Template Library
-      </title>
-      <date>
-	2001
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Scott
-	  </firstname>
-	  <surname>
-	    Meyers
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 30 -->
-    <biblioentry xml:id="biblio.meyers02both">
-      <title>
-	Class Template, Member Template - or Both?
-      </title>
-      <date>
-	2003
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Scott
-	  </firstname>
-	  <surname>
-	    Meyers
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  C/C++ Users Journal
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 31 -->
-    <biblioentry xml:id="biblio.motwani95random">
-      <title>
-	Randomized Algorithms
-      </title>
-      <date>
-	2003
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      R.
-	    </firstname>
-	    <surname>
-	      Motwani
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      P.
-	    </firstname>
-	    <surname>
-	      Raghavan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  Cambridge University Press
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 32 -->
-    <biblioentry xml:id="biblio.mscom">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.microsoft.com/com">
-	  COM: Component Model Object Technologies
-	</link>
-      </title>
-      <publisher>
-	<publishername>
-	  Microsoft
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 33 -->
-    <biblioentry xml:id="biblio.musser95rationale">
-      <title>
-	Rationale for Adding Hash Tables to the C++ Standard Template Library
-      </title>
-      <date>
-	1995
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    David R.
-	  </firstname>
-	  <surname>
-	    Musser
-	  </surname>
-	</personname>
-      </author>
-
-    </biblioentry>
-
-    <!-- 35 -->
-    <biblioentry xml:id="biblio.musser96stltutorial">
-      <title>
-	STL Tutorial and Reference Guide
-      </title>
-      <date>
-	1996
-      </date>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      David R.
-	    </firstname>
-	    <surname>
-	      Musser
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      A.
-	    </firstname>
-	    <surname>
-	      Saini
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-
-    </biblioentry>
-
-
-    <!-- 36 -->
-    <biblioentry xml:id="biblio.nelson96stlpq">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.dogma.net/markn/articles/pq_stl/priority.htm">Priority Queues and the STL
-	</link>
-      </title>
-      <date>
-	January 1996
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Mark
-	  </firstname>
-	  <surname>
-	    Nelson
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Dr. Dobbs Journal
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 37 -->
-    <biblioentry xml:id="biblio.okasaki98mereable">
-      <title>
-	Fast mergeable integer maps
-      </title>
-      <date>
-	September 1998
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      C.
-	    </firstname>
-	    <surname>
-	      Okasaki
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      A.
-	    </firstname>
-	    <surname>
-	      Gill
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  In Workshop on ML
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 38 -->
-    <biblioentry xml:id="biblio.sgi_stl">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.sgi.com/tech/stl">
-	  Standard Template Library Programmer's Guide
-	</link>
-      </title>
-      <author>
-	<personname>
-	  <firstname>
-	    Matt
-	  </firstname>
-	  <surname>
-	    Austern
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  SGI
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 39 -->
-    <biblioentry xml:id="biblio.select_man">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://www.scit.wlv.ac.uk/cgi-bin/mansec?3C+select">
-	  select
-	</link>
-      </title>
-    </biblioentry>
-
-
-    <!-- 40 -->
-    <biblioentry xml:id="biblio.sleator84amortized">
-      <title>
-	Amortized Efficiency of List Update Problems
-      </title>
-      <date>
-	1984
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      D. D.
-	    </firstname>
-	    <surname>
-	      Sleator
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      R. E.
-	    </firstname>
-	    <surname>
-	      Tarjan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  ACM Symposium on Theory of Computing
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 41 -->
-    <biblioentry xml:id="biblio.sleator85self">
-      <title>
-	Self-Adjusting Binary Search Trees
-      </title>
-      <date>
-	1985
-      </date>
-
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      D. D.
-	    </firstname>
-	    <surname>
-	      Sleator
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      R. E.
-	    </firstname>
-	    <surname>
-	      Tarjan
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-
-      <publisher>
-	<publishername>
-	  ACM Symposium on Theory of Computing
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 42 -->
-    <biblioentry xml:id="biblio.stepanov94standard">
-      <title>
-	The Standard Template Library
-      </title>
-      <date>
-	1984
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      A. A.
-	    </firstname>
-	    <surname>
-	      Stepanov
-	    </surname>
-	  </personname>
-	</author>
-	<author>
-	  <personname>
-	    <firstname>
-	      M.
-	    </firstname>
-	    <surname>
-	      Lee
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-    </biblioentry>
-
-    <!-- 43 -->
-    <biblioentry xml:id="biblio.stroustrup97cpp">
-      <title>
-	The C++ Programming Langugage
-      </title>
-      <date>
-	1997
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    Bjarne
-	  </firstname>
-	  <surname>
-	    Stroustrup
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-    <!-- 44 -->
-    <biblioentry xml:id="biblio.vandevoorde2002cpptemplates">
-      <title>
-	C++ Templates: The Complete Guide
-      </title>
-      <date>
-	2002
-      </date>
-      <authorgroup>
-	<author>
-	  <personname>
-	    <firstname>
-	      D.
-	    </firstname>
-	    <surname>
-	      Vandevoorde
-	    </surname>
-	  </personname>
-	</author>
-
-	<author>
-	  <personname>
-	    <firstname>
-	      N. M.
-	    </firstname>
-	    <surname>
-	      Josuttis
-	    </surname>
-	  </personname>
-	</author>
-      </authorgroup>
-      <publisher>
-	<publishername>
-	  Addison-Wesley Publishing Company
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-    <!-- 45 -->
-    <biblioentry xml:id="biblio.wickland96thirty">
-      <title>
-	<link xmlns:xlink="http://www.w3.org/1999/xlink"
-	      xlink:href="http://myweb.wvnet.edu/~gsa00121/books/amongdead30.zip">
-	  Thirty Years Among the Dead
-	</link>
-      </title>
-      <date>
-	1996
-      </date>
-
-      <author>
-	<personname>
-	  <firstname>
-	    C. A.
-	  </firstname>
-	  <surname>
-	    Wickland
-	  </surname>
-	</personname>
-      </author>
-
-      <publisher>
-	<publishername>
-	  National Psychological Institute
-	</publishername>
-      </publisher>
-    </biblioentry>
-
-
-  </bibliography>
-
 </chapter>
Index: libstdc++-v3/doc/xml/manual/documentation_hacking.xml
===================================================================
--- a/src/libstdc++-v3/doc/xml/manual/documentation_hacking.xml	(revision
+++ b/src/libstdc++-v3/doc/xml/manual/documentation_hacking.xml	(revision
@@ -102,14 +102,10 @@
 	    in the following directories:
 	  </para>
 	  <para>
-	    <filename class="directory">
-	      doc/libstdc++/libstdc++-api.html
-	    </filename>
+	    <filename>doc/libstdc++/libstdc++-api.html</filename>
 	  </para>
 	  <para>
-	    <filename class="directory">
-	      doc/libstdc++/libstdc++-manual.html
-	    </filename>
+	    <filename>doc/libstdc++/libstdc++-manual.html</filename>
 	  </para>
 	</listitem>
       </varlistentry>
@@ -346,6 +342,76 @@
 
     </section>
 
+ <section xml:id="doxygen.debug">
+   <info><title>Debugging Generation</title></info>
+   
+	<para>
+	  Sometimes, mis-configuration of the pre-requisite tools can
+	  lead to errors when attempting to build the
+	  documentation. Here are some of the obvious errors, and ways
+	  to fix some common issues that may appear quite cryptic.
+	</para>
+	
+	<para>
+	  First, if using a rule like <code>make pdf</code>, try to
+	  narrow down the scope of the error to either docbook
+	  (<code>make doc-pdf-docbook</code>) or doxygen (<code>make
+	  doc-pdf-doxygen</code>).
+	</para>
+	<para>
+	  Working on the doxygen path only, closely examine the
+	  contents of the following build directory:
+	  <filename>build/target/libstdc++-v3/doc/doxygen/latex</filename>.
+	  Pay attention to three files enclosed within, annotated as follows.
+	</para>
+<itemizedlist>
+
+<listitem>
+  <para>
+   <emphasis>refman.tex</emphasis>
+  </para>
+
+  <para>
+    The actual latex file, or partial latex file. This is generated
+    via <command>doxygen</command>, and is the LaTeX version of the
+    Doxygen XML file <filename>libstdc++-api.xml</filename>. Go to a specific
+    line, and look at the genrated LaTeX, and try to deduce what
+    markup in <filename>libstdc++-api.xml</filename> is causing it.
+  </para>
+</listitem>
+
+<listitem>
+  <para>
+   <emphasis>refman.out</emphasis>
+  </para>
+
+  <para>
+    A log of the compilation of the converted LaTeX form to pdf. This
+    is a linear list, from the beginning of the
+    <filename>refman.tex</filename> file: the last entry of this file
+    should be the end of the LaTeX file. If it is truncated, then you
+    know that the last entry is the last part of the generated LaTeX
+    source file that is valid. Often this file contains an error with
+    a specific line number of <filename>refman.tex</filename> that is
+    incorrect, or will have clues at the end of the file with the dump
+    of the memory usage of LaTeX.
+  </para>
+</listitem>
+</itemizedlist>
+
+	<para>
+	  If the error at hand is not obvious after examination, a
+	  fall-back strategy is to start commenting out the doxygen
+	  input sources, which can be found in
+	  <filename>doc/doxygen/user.cfg.in</filename>, look for the
+	  <literal>INPUT</literal> tag. Start by commenting out whole
+	  directories of header files, until the offending header is
+	  identified. Then, read the latex log files to try and find
+	  surround text, and look for that in the offending header.
+	</para>
+
+ </section>
+
     <section xml:id="doxygen.markup"><info><title>Markup</title></info>
       
 
@@ -742,6 +808,95 @@
 
       </section>
 
+    <section xml:id="docbook.debug">
+	<info><title>Debugging Generation</title></info>
+
+	<para>
+	  Sometimes, mis-configuration of the pre-requisite tools can
+	  lead to errors when attempting to build the
+	  documentation. Here are some of the obvious errors, and ways
+	  to fix some common issues that may appear quite cryptic.
+	</para>
+	
+	<para>
+	  First, if using a rule like <code>make pdf</code>, try to
+	  narrow down the scope of the error to either docbook
+	  (<code>make doc-pdf-docbook</code>) or doxygen (<code>make
+	  doc-pdf-doxygen</code>).
+	</para>
+
+	<para>
+	  Working on the docbook path only, closely examine the
+	  contents of the following build directory:
+	  <filename>build/target/libstdc++-v3/doc/docbook/latex</filename>.
+	  Pay attention to three files enclosed within, annotated as follows.
+	</para>
+
+<itemizedlist>
+
+<listitem>
+  <para>
+   <emphasis>spine.tex</emphasis>
+  </para>
+
+  <para>
+    The actual latex file, or partial latex file. This is generated
+    via <command>dblatex</command>, and is the LaTeX version of the
+    DocBook XML file <filename>spine.xml</filename>. Go to a specific
+    line, and look at the genrated LaTeX, and try to deduce what
+    markup in <filename>spine.xml</filename> is causing it.
+  </para>
+</listitem>
+
+<listitem>
+  <para>
+   <emphasis>spine.out</emphasis>
+  </para>
+
+  <para>
+    A log of the conversion from the XML form to the LaTeX form. This
+    is a linear list, from the beginning of the
+    <filename>spine.xml</filename> file: the last entry of this file
+    should be the end of the DocBook file. If it is truncated, then
+    you know that the last entry is the last part of the XML source
+    file that is valid. The error is after this point.
+  </para>
+</listitem>
+
+
+<listitem>
+  <para>
+   <emphasis>spine.log</emphasis>
+  </para>
+
+  <para>
+    A log of the compilation of the converted LaTeX form to pdf. This
+    is a linear list, from the beginning of the
+    <filename>spine.tex</filename> file: the last entry of this file
+    should be the end of the LaTeX file. If it is truncated, then you
+    know that the last entry is the last part of the generated LaTeX
+    source file that is valid. Often this file contains an error with
+    a specific line number of <filename>spine.tex</filename> that is
+    incorrect.
+  </para>
+</listitem>
+
+</itemizedlist>
+
+	<para>
+	  If the error at hand is not obvious after examination, or if one
+	  encounters the inscruitable <quote>Incomplete
+	  \ifmmode</quote> error, a fall-back strategy is to start
+	  commenting out parts of the XML document (regardless of what
+	  this does to over-all document validity). Start by
+	  commenting out each of the largest parts of the
+	  <filename>spine.xml</filename> file, section by section,
+	  until the offending section is identified.
+	</para>
+
+
+    </section>
+
     <section xml:id="docbook.validation"><info><title>Editing and Validation</title></info>
 
       <para>
Index: libstdc++-v3/doc/Makefile.in
===================================================================
--- a/src/libstdc++-v3/doc/Makefile.in	(revision
+++ b/src/libstdc++-v3/doc/Makefile.in	(revision
@@ -388,6 +388,7 @@
 	${xml_dir}/manual/numerics.xml \
 	${xml_dir}/manual/parallel_mode.xml \
 	${xml_dir}/manual/policy_data_structures.xml \
+	${xml_dir}/manual/policy_data_structures_biblio.xml \
 	${xml_dir}/manual/prerequisites.xml \
 	${xml_dir}/manual/profile_mode.xml \
 	${xml_dir}/manual/shared_ptr.xml \
@@ -523,17 +524,18 @@
 XSL_HTML_SINGLE_STYLE = $(XSL_STYLE_DIR)/html/docbook.xsl
 XSL_EPUB_STYLE = $(XSL_STYLE_DIR)/epub3/chunk.xsl
 XSL_LOCAL_STYLE = ${glibcxx_builddir}/doc/xsl/customization.xsl
-LINT_FLAGS = --debug --xinclude --noent --noblanks --noout
-SCHEMA_FLAGS = http://www.docbook.org/xml/5.0/dtd/docbook.dtd
-#SCHEMA_FLAGS = --nonet /usr/share/xml/docbook5/schema/dtd/5.0/docbook.dtd
-XMLLINT_VALID_FLAGS = $(LINT_FLAGS) --dtdvalid $(SCHEMA_FLAGS)
-XMLLINT_FLAGS = --xinclude --nsclean --c14n --noent --noblanks --nocdata
 
 # XML, all one page
 # Some info on canonicalization
 # http://www.mail-archive.com/help-texinfo@gnu.org/msg00864.html
 manual_xml = ${docbook_outdir}/xml/libstdc++-manual-single.xml
 set_xml = ${docbook_outdir}/xml/libstdc++-set-single.xml
+LINT_FLAGS = --debug --xinclude --noent --noblanks --noout
+SCHEMA_FLAGS = --dtdvalid http://www.docbook.org/xml/5.0/dtd/docbook.dtd
+SCHEMA_RNG_FLAGS = --relaxng http://www.docbook.org/xml/5.0/rng/docbook.rng
+#SCHEMA_FLAGS = --nonet --dtdvalid /usr/share/xxx/dtd/5.0/docbook.dtd
+XMLLINT_VALID_FLAGS = $(LINT_FLAGS) $(SCHEMA_FLAGS)
+XMLLINT_FLAGS = --xinclude --nsclean --c14n --noent --noblanks --nocdata
 
 # HTML, all one page
 # NB: Have to generate customization XSL for UTF-8 output.
@@ -541,7 +543,7 @@
 
 # PDF, via dblatex
 manual_pdf = ${docbook_outdir}/pdf/libstdc++-manual.pdf
-DBLATEX_FLAGS = --dump --verbose --pdf
+DBLATEX_FLAGS = --verbose --pdf --dump --debug --tmpdir=${docbook_outdir}/latex
 
 # TEXINFO, via docbook2X
 # NB: Both experimental and tempermental
@@ -891,14 +893,14 @@
 ${docbook_outdir}/pdf:
 	mkdir -p ${docbook_outdir}/pdf
 
+${docbook_outdir}/latex:
+	mkdir -p ${docbook_outdir}/latex
+
 ${docbook_outdir}/texinfo:
 	mkdir -p ${docbook_outdir}/texinfo
 
 ${docbook_outdir}/xml:
 	mkdir -p ${docbook_outdir}/xml
-doc-xml-validate-docbook: $(xml_sources) $(xml_images)
-	@echo "Generating XML validation log..."
-	$(XMLLINT) $(XMLLINT_VALID_FLAGS) ${top_srcdir}/doc/xml/spine.xml
 stamp-xml-single-docbook: $(xml_sources) ${docbook_outdir}/xml
 	@echo "Generating XML single..."
 	$(XMLLINT) $(XMLLINT_FLAGS) \
@@ -908,7 +910,16 @@
 	$(STAMP) stamp-xml-single-docbook
 
 doc-xml-single-docbook: stamp-xml-single-docbook
+doc-xml-validate-docbook: doc-xml-validate-dtd-db
 
+doc-xml-validate-dtd-db: $(xml_sources) $(xml_images)
+	@echo "Generating XML validation log..."
+	$(XMLLINT) $(XMLLINT_VALID_FLAGS) ${top_srcdir}/doc/xml/spine.xml
+
+doc-xml-validate-rng-db: $(xml_sources) $(xml_images) doc-xml-single-docbook
+	@echo "Generating XML RelaxNG validation log..."
+	$(XMLLINT) $(LINT_FLAGS) $(SCHEMA_RNG_FLAGS) ${set_xml}
+
 # HTML support files
 stamp-html-docbook-images: stamp-html-docbook $(xml_images)
 	$(INSTALL_DATA)	$(xml_images) ${docbook_outdir}/html/images
@@ -948,10 +959,15 @@
 	$(STAMP) stamp-fo-docbook
 
 doc-fo-docbook: stamp-fo-docbook
-stamp-pdf-docbook: $(xml_sources) ${docbook_outdir}/pdf
+
+doc-pdf-docbook-dirs: ${docbook_outdir}/pdf ${docbook_outdir}/latex
+
+doc-pdf-docbook-pre: $(xml_sources) doc-pdf-docbook-dirs
+
+stamp-pdf-docbook: doc-pdf-docbook-pre doc-xml-single-docbook
 	@echo "Generating pdf dblatex files..."
-	dblatex $(DBLATEX_FLAGS) \
-	-o ${manual_pdf} ${top_srcdir}/doc/xml/spine.xml
+	dblatex $(DBLATEX_FLAGS) -o ${manual_pdf} \
+	${top_srcdir}/doc/xml/spine.xml
 	$(STAMP) stamp-pdf-docbook
 
 doc-pdf-docbook: stamp-pdf-docbook
Index: libstdc++-v3/doc/xsl/customization.xsl.in
===================================================================
--- a/src/libstdc++-v3/doc/xsl/customization.xsl.in	(revision
+++ b/src/libstdc++-v3/doc/xsl/customization.xsl.in	(revision

Property changes on: libstdc++-v3/doc/xsl/customization.xsl.in
___________________________________________________________________
Modified: svn:mime-type
## -1 +1 ##
-application/xml
+text/xml
\ No newline at end of property
Index: libstdc++-v3/doc/Makefile.am
===================================================================
--- a/src/libstdc++-v3/doc/Makefile.am	(revision
+++ b/src/libstdc++-v3/doc/Makefile.am	(revision
@@ -332,6 +332,7 @@
 	${xml_dir}/manual/numerics.xml \
 	${xml_dir}/manual/parallel_mode.xml \
 	${xml_dir}/manual/policy_data_structures.xml \
+	${xml_dir}/manual/policy_data_structures_biblio.xml \
 	${xml_dir}/manual/prerequisites.xml \
 	${xml_dir}/manual/profile_mode.xml \
 	${xml_dir}/manual/shared_ptr.xml \
@@ -486,22 +487,15 @@
 ${docbook_outdir}/pdf:
 	mkdir -p ${docbook_outdir}/pdf
 
+${docbook_outdir}/latex:
+	mkdir -p ${docbook_outdir}/latex
+
 ${docbook_outdir}/texinfo:
 	mkdir -p ${docbook_outdir}/texinfo
 
 ${docbook_outdir}/xml:
 	mkdir -p ${docbook_outdir}/xml
 
-# Validate existing XML structure.
-XMLLINT = xmllint
-LINT_FLAGS = --debug --xinclude --noent --noblanks --noout
-SCHEMA_FLAGS = http://www.docbook.org/xml/5.0/dtd/docbook.dtd
-#SCHEMA_FLAGS = --nonet /usr/share/xml/docbook5/schema/dtd/5.0/docbook.dtd
-XMLLINT_VALID_FLAGS = $(LINT_FLAGS) --dtdvalid $(SCHEMA_FLAGS)
-XMLLINT_FLAGS = --xinclude --nsclean --c14n --noent --noblanks --nocdata
-doc-xml-validate-docbook: $(xml_sources) $(xml_images)
-	@echo "Generating XML validation log..."
-	$(XMLLINT) $(XMLLINT_VALID_FLAGS) ${top_srcdir}/doc/xml/spine.xml
 
 # XML, all one page
 # Some info on canonicalization
@@ -518,6 +512,24 @@
 
 doc-xml-single-docbook: stamp-xml-single-docbook
 
+# Validate existing XML structure.
+XMLLINT = xmllint
+LINT_FLAGS = --debug --xinclude --noent --noblanks --noout
+SCHEMA_FLAGS = --dtdvalid http://www.docbook.org/xml/5.0/dtd/docbook.dtd
+SCHEMA_RNG_FLAGS = --relaxng http://www.docbook.org/xml/5.0/rng/docbook.rng
+#SCHEMA_FLAGS = --nonet --dtdvalid /usr/share/xxx/dtd/5.0/docbook.dtd
+XMLLINT_VALID_FLAGS = $(LINT_FLAGS) $(SCHEMA_FLAGS)
+XMLLINT_FLAGS = --xinclude --nsclean --c14n --noent --noblanks --nocdata
+doc-xml-validate-docbook: doc-xml-validate-dtd-db
+
+doc-xml-validate-dtd-db: $(xml_sources) $(xml_images)
+	@echo "Generating XML validation log..."
+	$(XMLLINT) $(XMLLINT_VALID_FLAGS) ${top_srcdir}/doc/xml/spine.xml
+
+doc-xml-validate-rng-db: $(xml_sources) $(xml_images) doc-xml-single-docbook
+	@echo "Generating XML RelaxNG validation log..."
+	$(XMLLINT) $(LINT_FLAGS) $(SCHEMA_RNG_FLAGS) ${set_xml}
+
 # HTML support files
 stamp-html-docbook-images: stamp-html-docbook $(xml_images)
 	$(INSTALL_DATA)	$(xml_images) ${docbook_outdir}/html/images
@@ -564,11 +576,16 @@
 
 # PDF, via dblatex
 manual_pdf = ${docbook_outdir}/pdf/libstdc++-manual.pdf
-DBLATEX_FLAGS = --dump --verbose --pdf
-stamp-pdf-docbook: $(xml_sources) ${docbook_outdir}/pdf
+DBLATEX_FLAGS = --verbose --pdf --dump --debug --tmpdir=${docbook_outdir}/latex
+
+doc-pdf-docbook-dirs: ${docbook_outdir}/pdf ${docbook_outdir}/latex
+
+doc-pdf-docbook-pre: $(xml_sources) doc-pdf-docbook-dirs
+
+stamp-pdf-docbook: doc-pdf-docbook-pre doc-xml-single-docbook
 	@echo "Generating pdf dblatex files..."
-	dblatex $(DBLATEX_FLAGS) \
-	-o ${manual_pdf} ${top_srcdir}/doc/xml/spine.xml
+	dblatex $(DBLATEX_FLAGS) -o ${manual_pdf} \
+	${top_srcdir}/doc/xml/spine.xml
 	$(STAMP) stamp-pdf-docbook
 
 doc-pdf-docbook: stamp-pdf-docbook
Index: libstdc++-v3/include/ext/string_conversions.h
===================================================================
--- a/src/libstdc++-v3/include/ext/string_conversions.h	(revision
+++ b/src/libstdc++-v3/include/ext/string_conversions.h	(revision
@@ -1,6 +1,6 @@
 // String Conversions -*- C++ -*-
 
-// Copyright (C) 2008, 2009, 2010 Free Software Foundation, Inc.
+// Copyright (C) 2008, 2009, 2010, 2012 Free Software Foundation, Inc.
 //
 // This file is part of the GNU ISO C++ Library.  This library is free
 // software; you can redistribute it and/or modify it under the
@@ -31,6 +31,10 @@
 
 #pragma GCC system_header
 
+#ifndef __GXX_EXPERIMENTAL_CXX0X__
+# include <bits/c++0x_warning.h>
+#else
+
 #include <bits/c++config.h>
 #include <ext/numeric_traits.h>
 #include <bits/functexcept.h>
@@ -98,4 +102,6 @@
 _GLIBCXX_END_NAMESPACE_VERSION
 } // namespace
 
+#endif // C++11
+
 #endif // _STRING_CONVERSIONS_H
Index: libstdc++-v3/include/ext/pointer.h
===================================================================
--- a/src/libstdc++-v3/include/ext/pointer.h	(revision
+++ b/src/libstdc++-v3/include/ext/pointer.h	(revision
@@ -1,6 +1,6 @@
 // Custom pointer adapter and sample storage policies
 
-// Copyright (C) 2008, 2009, 2010 Free Software Foundation, Inc.
+// Copyright (C) 2008, 2009, 2010, 2012 Free Software Foundation, Inc.
 //
 // This file is part of the GNU ISO C++ Library.  This library is free
 // software; you can redistribute it and/or modify it under the
@@ -43,6 +43,7 @@
 #include <ext/cast.h>
 #include <ext/type_traits.h>
 #ifdef __GXX_EXPERIMENTAL_CXX0X__
+# include <bits/move.h>
 # include <bits/ptr_traits.h>
 #endif
 
Index: libstdc++-v3/include/ext/alloc_traits.h
===================================================================
--- a/src/libstdc++-v3/include/ext/alloc_traits.h	(revision
+++ b/src/libstdc++-v3/include/ext/alloc_traits.h	(revision
@@ -32,6 +32,7 @@
 #pragma GCC system_header
 
 #ifdef __GXX_EXPERIMENTAL_CXX0X__
+# include <bits/move.h>
 # include <bits/alloc_traits.h>
 #else
 # include <bits/allocator.h>  // for __alloc_swap
Index: libstdc++-v3/ChangeLog
===================================================================
--- a/src/libstdc++-v3/ChangeLog	(revision
+++ b/src/libstdc++-v3/ChangeLog	(revision
@@ -1,3 +1,48 @@
+2012-12-17  Jonathan Wakely  <jwakely.gcc@gmail.com>
+
+	* src/c++11/thread.cc: Update copyright years.
+
+2012-12-16  Jonathan Wakely  <jwakely.gcc@gmail.com>
+
+	* src/c++11/thread.cc (execute_native_thread_routine): Do not swallow
+	__forced_unwind exceptions.
+	* testsuite/30_threads/thread/native_handle/cancel.cc: New.
+
+2012-12-12  Jonathan Wakely  <jwakely.gcc@gmail.com>
+
+	PR libstdc++/55631
+	* include/ext/alloc_traits.h: Include missing header.
+	* include/ext/pointer.h: Likewise.
+	* include/ext/string_conversions.h: Require C++11.
+	* libsupc++/initializer_list: Reindent.
+
+2012-12-12  Benjamin Kosnik  <bkoz@redhat.com>
+
+        * doc/xml/manual/documentation_hacking.xml: Fix validation issue.
+
+2012-12-10  Benjamin Kosnik  <bkoz@redhat.com>
+
+	* doc/Makefile.am (xml_sources_manual): Add
+	policy_data_structures_biblio.xml.
+	(${docbook_outdir}/latex): Add.
+	(doc-xml-validate-docbook): Split into..
+	(doc-xml-validate-dtd-db):... this for DTD.
+	(doc-xml-validate-rng-db):... this for Relax NG.
+	(doc-pdf-docbook-dirs): Add.
+	(doc-pdf-docbook-pre): Add.
+	* doc/xml/manual/build_hacking.xml: Add literal markup.
+	* doc/xml/manual/documentation_hacking.xml: Clean whitespace in
+	<filename> markup. Add notes about debugging the generation process.
+	* doc/xml/manual/policy_data_structures.xml: Split biblio into...
+	* doc/xml/manual/policy_data_structures_biblio.xml: ... this. New.
+	* doc/xml/manual/test_policy_data_structures.xml: Fixup <filename>
+	markup.
+
+2012-12-10  Matthias Klose  <doko@ubuntu.com>
+
+	* src/Makefile.am (libstdc++-symbols.ver): Use CONFIG_HEADER.
+	* src/Makefile.in: Regenerate.
+
 2012-12-01  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>
 
 	PR libstdc++/55503
Index: libstdc++-v3/libsupc++/initializer_list
===================================================================
--- a/src/libstdc++-v3/libsupc++/initializer_list	(revision
+++ b/src/libstdc++-v3/libsupc++/initializer_list	(revision
@@ -1,6 +1,6 @@
 // std::initializer_list support -*- C++ -*-
 
-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.
+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.
 //
 // This file is part of GCC.
 //
@@ -77,7 +77,7 @@
       // One past the last element.
       constexpr const_iterator
       end() const noexcept { return begin() + size(); }
-  };
+    };
 
   /**
    *  @brief  Return an iterator pointing to the first element of
Index: libstdc++-v3/testsuite/30_threads/thread/native_handle/cancel.cc
===================================================================
--- a/src/libstdc++-v3/testsuite/30_threads/thread/native_handle/cancel.cc	(revision
+++ b/src/libstdc++-v3/testsuite/30_threads/thread/native_handle/cancel.cc	(revision
@@ -0,0 +1,45 @@
+// { dg-do run { target *-*-freebsd* *-*-netbsd* *-*-linux* *-*-solaris* *-*-cygwin *-*-darwin* powerpc-ibm-aix* } }
+// { dg-options " -std=gnu++0x -pthread" { target *-*-freebsd* *-*-netbsd* *-*-linux* powerpc-ibm-aix* } }
+// { dg-options " -std=gnu++0x -pthreads" { target *-*-solaris* } }
+// { dg-options " -std=gnu++0x " { target *-*-cygwin *-*-darwin* } }
+// { dg-require-cstdint "" }
+// { dg-require-gthreads "" }
+// { dg-require-nanosleep "" }
+
+// Copyright (C) 2012 Free Software Foundation, Inc.
+//
+// This file is part of the GNU ISO C++ Library.  This library is free
+// software; you can redistribute it and/or modify it under the
+// terms of the GNU General Public License as published by the
+// Free Software Foundation; either version 3, or (at your option)
+// any later version.
+
+// This library is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+
+// You should have received a copy of the GNU General Public License along
+// with this library; see the file COPYING3.  If not see
+// <http://www.gnu.org/licenses/>.
+
+#include <pthread.h>
+#include <thread>
+#include <atomic>
+
+void f(std::atomic<bool>& started)
+{
+  started = true;
+  while (true)
+    std::this_thread::sleep_for(std::chrono::milliseconds(100));
+}
+
+int main()
+{
+  std::atomic<bool> started{ false };
+  std::thread t(f, std::ref(started));
+  while (!started)
+    std::this_thread::sleep_for(std::chrono::milliseconds(100));
+  pthread_cancel(t.native_handle());
+  t.join();
+}
Index: libgcc/ChangeLog
===================================================================
--- a/src/libgcc/ChangeLog	(revision
+++ b/src/libgcc/ChangeLog	(revision
@@ -1,3 +1,8 @@
+2012-12-09  Uros Bizjak  <ubizjak@gmail.com>
+
+	PR target/55344
+	* config/alpha/linux-unwind.h: Disable when inhibit_libc is defined.
+
 2012-12-04  Richard Henderson  <rth@redhat.com>
 
 	PR bootstrap/55571
Index: libgcc/config/alpha/linux-unwind.h
===================================================================
--- a/src/libgcc/config/alpha/linux-unwind.h	(revision
+++ b/src/libgcc/config/alpha/linux-unwind.h	(revision
@@ -22,6 +22,7 @@
 see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see
 <http://www.gnu.org/licenses/>.  */
 
+#ifndef inhibit_libc
 /* Do code reading to identify a signal frame, and set the frame
    state data appropriately.  See unwind-dw2.c for the structs.  */
 
@@ -97,3 +98,4 @@
 	  || pc[1] == 0x201f015f))	/* lda $0,NR_rt_sigreturn */
     _Unwind_SetSignalFrame (context, 1);
 }
+#endif
Index: gcc/optabs.c
===================================================================
--- a/src/gcc/optabs.c	(revision
+++ b/src/gcc/optabs.c	(revision
@@ -7700,14 +7700,14 @@
   if (!target || target == const0_rtx)
     target = gen_reg_rtx (mode);
 
-  /* Emit the appropriate barrier before the load.  */
-  expand_mem_thread_fence (model);
+  /* For SEQ_CST, emit a barrier before the load.  */
+  if (model == MEMMODEL_SEQ_CST)
+    expand_mem_thread_fence (model);
 
   emit_move_insn (target, mem);
 
-  /* For SEQ_CST, also emit a barrier after the load.  */
-  if (model == MEMMODEL_SEQ_CST)
-    expand_mem_thread_fence (model);
+  /* Emit the appropriate barrier after the load.  */
+  expand_mem_thread_fence (model);
 
   return target;
 }
@@ -7768,13 +7768,12 @@
         return NULL_RTX;
     }
 
-  /* If there is no mem_store, default to a move with barriers */
-  if (model == MEMMODEL_SEQ_CST || model == MEMMODEL_RELEASE)
-    expand_mem_thread_fence (model);
+  /* Otherwise assume stores are atomic, and emit the proper barriers.  */
+  expand_mem_thread_fence (model);
 
   emit_move_insn (mem, val);
 
-  /* For SEQ_CST, also emit a barrier after the load.  */
+  /* For SEQ_CST, also emit a barrier after the store.  */
   if (model == MEMMODEL_SEQ_CST)
     expand_mem_thread_fence (model);
 
Index: gcc/DATESTAMP
===================================================================
--- a/src/gcc/DATESTAMP	(revision
+++ b/src/gcc/DATESTAMP	(revision
@@ -1 +1 @@
-20121205
+20121217
Index: gcc/tree.c
===================================================================
--- a/src/gcc/tree.c	(revision
+++ b/src/gcc/tree.c	(revision
@@ -7409,10 +7409,15 @@
 
   if (shared)
     {
+      tree old_t = t;
       hashval_t hashcode = iterative_hash_object (TYPE_HASH (elt_type), 0);
       if (index_type)
 	hashcode = iterative_hash_object (TYPE_HASH (index_type), hashcode);
       t = type_hash_canon (hashcode, t);
+      if (t != old_t)
+	/* Lay it out again in case the element type has been completed since
+	   the array was added to the hash table.  */
+	layout_type (t);
     }
 
   if (TYPE_CANONICAL (t) == t)
Index: gcc/ChangeLog
===================================================================
--- a/src/gcc/ChangeLog	(revision
+++ b/src/gcc/ChangeLog	(revision
@@ -1,3 +1,57 @@
+2012-12-16  Eric Botcazou  <ebotcazou@adacore.com>
+	    Tomash Brechko  <tomash.brechko@gmail.com>
+
+	PR target/55673
+	* config/sparc/sparc.c (sparc_emit_membar_for_model): Fix reversed
+	handling of before and after cases.
+	* config/sparc/sync.md (atomic_store): Fix pasto.
+
+2012-12-14  Yvan Roux  <yvan.roux@linaro.org>
+
+	* optabs.c (expand_atomic_store): Elide redundant model test.
+
+2012-12-13  Richard Henderson  <rth@redhat.com>
+
+	PR middle-end/55492
+	* optabs.c (expand_atomic_load): Emit acquire barrier after the load.
+
+2012-12-11  Eric Botcazou  <ebotcazou@adacore.com>
+
+	PR target/54121
+	* config/sparc/sparc.md (tldo_stb_sp32): Fix pasto.
+	(tldo_stb_sp64): Likewise.
+	(tldo_sth_sp32): Likewise.
+	(tldo_sth_sp64): Likewise.
+	(tldo_stw_sp32): Likewise.
+	(tldo_stw_sp64): Likewise.
+	(tldo_stx_sp64): Likewise.
+
+2012-12-10 Kai Tietz  <ktietz@redhat.com>
+
+	PR target/53912
+	* print-tree.c (print_node): Cast from pointer via uintptr_t.
+
+2012-12-07  Uros Bizjak  <ubizjak@gmail.com>
+
+	Backport from mainline
+	2012-12-06  Uros Bizjak  <ubizjak@gmail.com>
+		    H.J. Lu  <hongjiu.lu@intel.com>
+
+	PR target/55597
+	* config/i386/i386.c (legitimize_tls_address): Zero-extend x to Pmode,
+	before using it as insn or call equivalent.
+
+2012-12-06  Jason Merrill  <jason@redhat.com>
+
+	PR c++/55032
+	* tree.c (build_array_type_1): Re-layout if we found it in the
+	hash table.
+
+2012-12-05  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>
+
+	* config/pa/pa.md: Use "const_int 0" instead of match_test to simplify
+	opaque cond in all call insns.
+
 2012-12-03  Eric Botcazou  <ebotcazou@adacore.com>
 
 	* config/ia64/ia64.c (ia64_compute_frame_size): Allocate the scratch
Index: gcc/testsuite/stack_check3.ads
===================================================================
--- a/src/gcc/testsuite/stack_check3.ads	(revision
+++ b/src/gcc/testsuite/stack_check3.ads	(revision
@@ -1,5 +0,0 @@
-package Stack_Check3 is
-
-  procedure Reset;
-
-end Stack_Check3;
Index: gcc/testsuite/stack_check3.adb
===================================================================
--- a/src/gcc/testsuite/stack_check3.adb	(revision
+++ b/src/gcc/testsuite/stack_check3.adb	(revision
@@ -1,36 +0,0 @@
--- { dg-do compile }
--- { dg-options "-O -fstack-check" }
-
-package body Stack_Check3 is
-
-  type Int_Arr is array (1 .. 34) of Integer;
-
-  type Rec (D : Boolean := False) is
-    record
-      case D is
-        when True  => IA : Int_Arr;
-        when False => null;
-      end case;
-    end record;
-
-  type Rec_Arr is array (1 .. 256) of Rec;
-
-  protected Prot_Arr is
-    procedure Reset;
-  private
-    A : Rec_Arr;
-  end Prot_Arr;
-
-  protected body Prot_Arr is
-    procedure Reset is
-    begin
-      A := (others => (D => False));
-    end Reset;
-  end Prot_Arr;
-
-  procedure Reset is
-  begin
-    Prot_Arr.Reset;
-  end Reset;
-
-end Stack_Check3;
Index: gcc/testsuite/gcc.target/i386/pr55597.c
===================================================================
--- a/src/gcc/testsuite/gcc.target/i386/pr55597.c	(revision
+++ b/src/gcc/testsuite/gcc.target/i386/pr55597.c	(revision
@@ -0,0 +1,18 @@
+/* { dg-do compile { target { ! { ia32 } } } } */
+/* { dg-require-effective-target fpic } */
+/* { dg-options "-O2 -fPIC -mx32" } */
+
+struct initial_sp
+{
+  void *sp;
+  int mask;
+};
+
+__thread struct initial_sp __morestack_initial_sp;
+
+void foo (int *);
+
+void __morestack_release_segments (void)
+{
+  foo (&__morestack_initial_sp.mask);
+}
Index: gcc/testsuite/gnat.dg/stack_check3.adb
===================================================================
--- a/src/gcc/testsuite/gnat.dg/stack_check3.adb	(revision
+++ b/src/gcc/testsuite/gnat.dg/stack_check3.adb	(revision
@@ -0,0 +1,36 @@
+-- { dg-do compile }
+-- { dg-options "-O -fstack-check" }
+
+package body Stack_Check3 is
+
+  type Int_Arr is array (1 .. 34) of Integer;
+
+  type Rec (D : Boolean := False) is
+    record
+      case D is
+        when True  => IA : Int_Arr;
+        when False => null;
+      end case;
+    end record;
+
+  type Rec_Arr is array (1 .. 256) of Rec;
+
+  protected Prot_Arr is
+    procedure Reset;
+  private
+    A : Rec_Arr;
+  end Prot_Arr;
+
+  protected body Prot_Arr is
+    procedure Reset is
+    begin
+      A := (others => (D => False));
+    end Reset;
+  end Prot_Arr;
+
+  procedure Reset is
+  begin
+    Prot_Arr.Reset;
+  end Reset;
+
+end Stack_Check3;
Index: gcc/testsuite/gnat.dg/stack_check3.ads
===================================================================
--- a/src/gcc/testsuite/gnat.dg/stack_check3.ads	(revision
+++ b/src/gcc/testsuite/gnat.dg/stack_check3.ads	(revision
@@ -0,0 +1,5 @@
+package Stack_Check3 is
+
+  procedure Reset;
+
+end Stack_Check3;
Index: gcc/testsuite/gnat.dg/controlled7.adb
===================================================================
--- a/src/gcc/testsuite/gnat.dg/controlled7.adb	(revision
+++ b/src/gcc/testsuite/gnat.dg/controlled7.adb	(revision
@@ -0,0 +1,18 @@
+-- PR ada/53766
+-- Reported by Duncan Sands <baldrick@gcc.gnu.org>
+
+-- { dg-do compile }
+-- { dg-options "-gnatp" }
+
+with Ada.Strings.Unbounded; use Ada.Strings.Unbounded;
+
+package body Controlled7 is
+
+   procedure Proc (Offset : Storage_Offset) is
+   begin
+      if Offset + Unbounded_String'Max_Size_In_Storage_Elements >= 16 then
+         raise Program_Error;
+      end if;
+   end;
+
+end Controlled7;
Index: gcc/testsuite/gnat.dg/controlled7.ads
===================================================================
--- a/src/gcc/testsuite/gnat.dg/controlled7.ads	(revision
+++ b/src/gcc/testsuite/gnat.dg/controlled7.ads	(revision
@@ -0,0 +1,7 @@
+with System.Storage_Elements; use System.Storage_Elements;
+
+package Controlled7 is
+
+  procedure Proc (Offset : Storage_Offset);
+
+end Controlled7;
Index: gcc/testsuite/gcc.dg/pr54121.c
===================================================================
--- a/src/gcc/testsuite/gcc.dg/pr54121.c	(revision
+++ b/src/gcc/testsuite/gcc.dg/pr54121.c	(revision
@@ -0,0 +1,94 @@
+/* PR target/54121 */
+/* Reported by Jan Engelhardt <jengelh@inai.de> */
+
+/* { dg-do compile { target fpic } } */
+/* { dg-options "-std=gnu99 -O -fPIC -fprofile-generate" } */
+
+typedef __SIZE_TYPE__ size_t;
+typedef unsigned char uint8_t;
+
+extern void *memcpy (void *__restrict __dest,
+       __const void *__restrict __src, size_t __n)
+     __attribute__ ((__nothrow__)) __attribute__ ((__nonnull__ (1, 2)));
+
+typedef enum {
+ LZMA_OK = 0,
+ LZMA_STREAM_END = 1,
+ LZMA_NO_CHECK = 2,
+ LZMA_UNSUPPORTED_CHECK = 3,
+ LZMA_GET_CHECK = 4,
+ LZMA_MEM_ERROR = 5,
+ LZMA_MEMLIMIT_ERROR = 6,
+ LZMA_FORMAT_ERROR = 7,
+ LZMA_OPTIONS_ERROR = 8,
+ LZMA_DATA_ERROR = 9,
+ LZMA_BUF_ERROR = 10,
+ LZMA_PROG_ERROR = 11,
+} lzma_ret;
+
+typedef enum {
+ LZMA_RUN = 0,
+ LZMA_SYNC_FLUSH = 1,
+ LZMA_FULL_FLUSH = 2,
+ LZMA_FINISH = 3
+} lzma_action;
+
+typedef struct {
+ void *( *alloc)(void *opaque, size_t nmemb, size_t size);
+ void ( *free)(void *opaque, void *ptr);
+ void *opaque;
+} lzma_allocator;
+
+typedef struct lzma_coder_s lzma_coder;
+
+typedef struct lzma_next_coder_s lzma_next_coder;
+
+typedef struct lzma_filter_info_s lzma_filter_info;
+
+typedef lzma_ret (*lzma_init_function)(
+  lzma_next_coder *next, lzma_allocator *allocator,
+  const lzma_filter_info *filters);
+
+typedef lzma_ret (*lzma_code_function)(
+  lzma_coder *coder, lzma_allocator *allocator,
+  const uint8_t *restrict in, size_t *restrict in_pos,
+  size_t in_size, uint8_t *restrict out,
+  size_t *restrict out_pos, size_t out_size,
+  lzma_action action);
+
+typedef void (*lzma_end_function)(
+  lzma_coder *coder, lzma_allocator *allocator);
+
+typedef struct {
+ uint8_t *buf;
+ size_t pos;
+ size_t size;
+} lzma_dict;
+
+typedef struct {
+ lzma_coder *coder;
+ lzma_ret (*code)(lzma_coder *restrict coder,
+   lzma_dict *restrict dict, const uint8_t *restrict in,
+   size_t *restrict in_pos, size_t in_size);
+} lzma_lz_decoder;
+
+struct lzma_coder_s {
+ lzma_dict dict;
+ lzma_lz_decoder lz;
+};
+
+lzma_ret
+decode_buffer(lzma_coder *coder,
+  const uint8_t *restrict in, size_t *restrict in_pos,
+  size_t in_size, uint8_t *restrict out, size_t *restrict out_pos)
+{
+ while (1) {
+  const size_t dict_start = coder->dict.pos;
+  const lzma_ret ret
+    = coder->lz.code( coder->lz.coder, &coder->dict, in, in_pos, in_size);
+  const size_t copy_size = coder->dict.pos - dict_start;
+  memcpy(out + *out_pos, coder->dict.buf + dict_start, copy_size);
+  if (ret != LZMA_OK || coder->dict.pos < coder->dict.size)
+   return ret;
+ }
+}
Index: gcc/testsuite/ChangeLog
===================================================================
--- a/src/gcc/testsuite/ChangeLog	(revision
+++ b/src/gcc/testsuite/ChangeLog	(revision
@@ -1,3 +1,25 @@
+2012-12-15  Eric Botcazou  <ebotcazou@adacore.com>
+
+	PR ada/53766
+	* gnat.dg/controlled7.ad[sb]: New test.
+
+2012-12-11  Jakub Jelinek  <jakub@redhat.com>
+
+	PR c++/55643
+	* g++.dg/warn/Wunused-var-19.C: New test.
+
+2012-12-11  Eric Botcazou  <ebotcazou@adacore.com>
+
+	* gcc.dg/pr54121.c: New test.
+
+2012-12-07  Uros Bizjak  <ubizjak@gmail.com>
+
+	Backport from mainline
+	2012-12-06  Uros Bizjak  <ubizjak@gmail.com>
+
+	PR target/55597
+	* gcc.target/i386/pr55597.c: New test.
+
 2012-12-03  Richard Biener  <rguenther@suse.de>
 
 	Backport from mainline
Index: gcc/testsuite/g++.dg/abi/anon1.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/abi/anon1.C	(revision
+++ b/src/gcc/testsuite/g++.dg/abi/anon1.C	(revision
@@ -0,0 +1,5 @@
+// PR c++/54883
+
+namespace { enum E { E1 }; } void f(E e) { }
+
+// { dg-final { scan-assembler-not "globl" } }
Index: gcc/testsuite/g++.dg/other/abstract3.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/other/abstract3.C	(revision
+++ b/src/gcc/testsuite/g++.dg/other/abstract3.C	(revision
@@ -8,5 +8,5 @@
 struct B
 {
   A a;           // { dg-error "abstract" }
-  B() : a() {}   // { dg-error "abstract" }
+  B() : a() {}
 };
Index: gcc/testsuite/g++.dg/warn/Wunused-var-19.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/warn/Wunused-var-19.C	(revision
+++ b/src/gcc/testsuite/g++.dg/warn/Wunused-var-19.C	(revision
@@ -0,0 +1,26 @@
+// PR c++/55643
+// { dg-do compile }
+// { dg-options "-std=c++11 -Wunused" }
+
+enum class E { e = 123 };
+
+int
+foo ()
+{
+  E x = E::e;
+  return (double) x;
+}
+
+int
+bar ()
+{
+  E x = E::e;
+  return (long double) x;
+}
+
+int
+baz ()
+{
+  E x = E::e;
+  return (float) x;
+}
Index: gcc/testsuite/g++.dg/cpp0x/lambda/lambda-initlist2.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/cpp0x/lambda/lambda-initlist2.C	(revision
+++ b/src/gcc/testsuite/g++.dg/cpp0x/lambda/lambda-initlist2.C	(revision
@@ -0,0 +1,27 @@
+// PR c++/54947
+// { dg-options -std=gnu++11 }
+
+struct X
+{
+  template<typename L>
+    X(L)
+    { }
+};
+
+template<typename A>
+  void
+  test()
+  {
+    int i = 0;
+
+    A a_ok_1( [=] { return i; } );  // OK
+    A a_ok_2( [i] { return i; } );  // OK
+
+    A a_err_1{ [i] { return i; } };  // error
+    A a_err_2{ [=] { return i; } };  // error
+  }
+
+int main()
+{
+  test<X>();
+}
Index: gcc/testsuite/g++.dg/cpp0x/lambda/lambda-conv6.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/cpp0x/lambda/lambda-conv6.C	(revision
+++ b/src/gcc/testsuite/g++.dg/cpp0x/lambda/lambda-conv6.C	(revision
@@ -0,0 +1,7 @@
+// PR c++/55015
+// { dg-do link }
+// { dg-options -std=c++11 }
+
+typedef void (*VoidFunc)();
+inline VoidFunc GetFunc() { return [](){}; }
+int main() { VoidFunc func = GetFunc(); }
Index: gcc/testsuite/g++.dg/cpp0x/constexpr-initlist6.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/cpp0x/constexpr-initlist6.C	(revision
+++ b/src/gcc/testsuite/g++.dg/cpp0x/constexpr-initlist6.C	(revision
@@ -0,0 +1,27 @@
+// PR c++/55419
+// { dg-options -std=c++11 }
+
+struct P
+{
+  P () = default;
+  explicit constexpr P (int x) : p (x) {}
+  int p;
+};
+
+struct Q
+{
+  constexpr Q () : q (0x7f) {}
+  int q;
+};
+
+struct R
+{
+  Q q;
+  P p;
+};
+
+void
+foo (R *x)
+{
+  *x = {};
+}
Index: gcc/testsuite/g++.dg/cpp0x/initlist-pure.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/cpp0x/initlist-pure.C	(revision
+++ b/src/gcc/testsuite/g++.dg/cpp0x/initlist-pure.C	(revision
@@ -0,0 +1,25 @@
+// PR c++/54325
+// { dg-options -std=c++11 }
+
+class Base {
+public:
+  Base() {};
+  virtual ~Base() {};
+
+  virtual void do_stuff() = 0;
+};
+
+class Derived: public Base {
+public:
+  Derived() : Base{} {};
+  virtual ~Derived() {};
+
+  virtual void do_stuff() {};
+};
+
+int
+main() {
+  Derived d;
+
+  return 0;
+}
Index: gcc/testsuite/g++.dg/template/array25.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/template/array25.C	(revision
+++ b/src/gcc/testsuite/g++.dg/template/array25.C	(revision
@@ -0,0 +1,18 @@
+// PR c++/55249
+
+template <typename _Tp> struct A
+{
+  _Tp _M_instance[1];
+};
+template <class> struct inner_type
+{
+    inner_type () {}
+    inner_type (inner_type &);
+    inner_type (const inner_type &) {}
+};
+
+int
+main ()
+{
+    A <inner_type <int> > a, b = a;
+}
Index: gcc/testsuite/g++.dg/template/meminit3.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/template/meminit3.C	(revision
+++ b/src/gcc/testsuite/g++.dg/template/meminit3.C	(revision
@@ -0,0 +1,12 @@
+// PR c++/54744
+
+template <typename T>
+struct base {
+  typedef base base_type;
+};
+
+template <typename T>
+struct derived : base<T> {
+  typedef typename derived::base_type::base_type base_type;
+  derived() : base_type() {}
+};
Index: gcc/testsuite/g++.dg/template/typedef40.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/template/typedef40.C	(revision
+++ b/src/gcc/testsuite/g++.dg/template/typedef40.C	(revision
@@ -0,0 +1,21 @@
+// PR c++/55058
+
+template <typename T>
+struct A { };
+
+template <typename T>
+struct B {
+  B(const A<T> T::* p);
+  typedef A<T> D;
+};
+
+template <typename T>
+B<T>::B(const D T::* p) { }
+
+struct C {
+  C() : e() {};
+
+  const A<C> e;
+};
+
+B<C> g(&C::e);
Index: gcc/testsuite/g++.dg/template/array24.C
===================================================================
--- a/src/gcc/testsuite/g++.dg/template/array24.C	(revision
+++ b/src/gcc/testsuite/g++.dg/template/array24.C	(revision
@@ -0,0 +1,22 @@
+// PR c++/55032
+
+template<typename T>
+struct vec3t {
+  T c[3];
+};
+
+typedef vec3t<float> vec3;
+
+class Bounds {
+  public:
+    Bounds(const vec3 bb[2]);
+    void foo(const vec3 & v) { v.c[0]; }
+};
+
+template<typename T>
+void work(T& value);
+
+void foo() {
+  vec3 bb[2];
+  work(bb);
+}
Index: gcc/cp/decl.c
===================================================================
--- a/src/gcc/cp/decl.c	(revision
+++ b/src/gcc/cp/decl.c	(revision
@@ -12928,10 +12928,9 @@
       if (DECL_NOT_REALLY_EXTERN (decl1))
 	DECL_EXTERNAL (decl1) = 0;
 
-      if (ctx != NULL_TREE && DECL_DECLARED_INLINE_P (ctx)
-	  && TREE_PUBLIC (ctx))
+      if (ctx != NULL_TREE && vague_linkage_p (ctx))
 	/* This is a function in a local class in an extern inline
-	   function.  */
+	   or template function.  */
 	comdat_linkage (decl1);
     }
   /* If this function belongs to an interface, it is public.
Index: gcc/cp/tree.c
===================================================================
--- a/src/gcc/cp/tree.c	(revision
+++ b/src/gcc/cp/tree.c	(revision
@@ -318,8 +318,6 @@
      side-effects, then the optimizer should be able to get rid of
      whatever code is generated anyhow.  */
   TREE_SIDE_EFFECTS (t) = 1;
-  if (literal_type_p (type))
-    TREE_CONSTANT (t) = TREE_CONSTANT (value);
 
   return t;
 }
@@ -396,18 +394,14 @@
    callable.  */
 
 tree
-build_aggr_init_expr (tree type, tree init, tsubst_flags_t complain)
+build_aggr_init_expr (tree type, tree init,
+		      tsubst_flags_t complain ATTRIBUTE_UNUSED)
 {
   tree fn;
   tree slot;
   tree rval;
   int is_ctor;
 
-  /* Make sure that we're not trying to create an instance of an
-     abstract class.  */
-  if (abstract_virtuals_error_sfinae (NULL_TREE, type, complain))
-    return error_mark_node;
-
   if (TREE_CODE (init) == CALL_EXPR)
     fn = CALL_EXPR_FN (init);
   else if (TREE_CODE (init) == AGGR_INIT_EXPR)
@@ -466,6 +460,11 @@
   tree rval = build_aggr_init_expr (type, init, complain);
   tree slot;
 
+  /* Make sure that we're not trying to create an instance of an
+     abstract class.  */
+  if (abstract_virtuals_error_sfinae (NULL_TREE, type, complain))
+    return error_mark_node;
+
   if (TREE_CODE (rval) == AGGR_INIT_EXPR)
     slot = AGGR_INIT_EXPR_SLOT (rval);
   else if (TREE_CODE (rval) == CALL_EXPR
@@ -513,7 +512,8 @@
   argvec = make_tree_vector ();
   if (init)
     {
-      tree dummy = build_dummy_object (inner_type);
+      tree init_type = strip_array_types (TREE_TYPE (init));
+      tree dummy = build_dummy_object (init_type);
       if (!real_lvalue_p (init))
 	dummy = move (dummy);
       VEC_quick_push (tree, argvec, dummy);
Index: gcc/cp/ChangeLog
===================================================================
--- a/src/gcc/cp/ChangeLog	(revision
+++ b/src/gcc/cp/ChangeLog	(revision
@@ -1,3 +1,48 @@
+2012-12-11  Jason Merrill  <jason@redhat.com>
+
+	PR c++/54883
+	* decl2.c (min_vis_r): Handle anon visibility for enums.
+
+2012-12-11  Jakub Jelinek  <jakub@redhat.com>
+
+	PR c++/55643
+	* expr.c (mark_exp_read): Handle FLOAT_EXPR similarly to NOP_EXPR.
+
+2012-12-07  Jason Merrill  <jason@redhat.com>
+
+	PR c++/55419
+	* tree.c (build_target_expr): Don't set TREE_CONSTANT.
+
+2012-12-07  Matthias Klose  <doko@ubuntu.com>
+
+	* tree.c (build_aggr_init_expr): Add parameter name, mark as unused.
+
+2012-12-06  Jason Merrill  <jason@redhat.com>
+
+	PR c++/54325
+	* tree.c (build_aggr_init_expr): Don't check for abstract class.
+	(build_cplus_new): Check here instead.
+
+	PR c++/55058
+	* pt.c (tsubst): Keep the quals when looking through a typedef.
+
+	PR c++/55249
+	* tree.c (build_vec_init_elt): Use the type of the initializer.
+
+	PR c++/54744
+	* pt.c (resolve_typename_type): Check TYPENAME_IS_RESOLVING_P on scope.
+
+	PR c++/54947
+	* parser.c (cp_parser_initializer_list): Don't require an
+	expression in [] to be constant until we know it's a C99
+	designator.
+
+	PR c++/55015
+	PR c++/53821
+	* semantics.c (maybe_add_lambda_conv_op): Revert earlier change.
+	* decl.c (start_preparsed_function): Make local class methods comdat
+	in templates, too.
+
 2012-11-29  Jason Merrill  <jason@redhat.com>
 
 	PR c++/53137
Index: gcc/cp/expr.c
===================================================================
--- a/src/gcc/cp/expr.c	(revision
+++ b/src/gcc/cp/expr.c	(revision
@@ -131,6 +131,7 @@
     CASE_CONVERT:
     case ADDR_EXPR:
     case INDIRECT_REF:
+    case FLOAT_EXPR:
       mark_exp_read (TREE_OPERAND (exp, 0));
       break;
     case COMPOUND_EXPR:
Index: gcc/cp/pt.c
===================================================================
--- a/src/gcc/cp/pt.c	(revision
+++ b/src/gcc/cp/pt.c	(revision
@@ -10908,8 +10908,13 @@
 	  return r;
 	}
       else
-	/* We don't have an instantiation yet, so drop the typedef.  */
-	t = DECL_ORIGINAL_TYPE (decl);
+	{
+	  /* We don't have an instantiation yet, so drop the typedef.  */
+	  int quals = cp_type_quals (t);
+	  t = DECL_ORIGINAL_TYPE (decl);
+	  t = cp_build_qualified_type_real (t, quals,
+					    complain | tf_ignore_bad_quals);
+	}
     }
 
   if (type
@@ -19806,7 +19811,16 @@
   /* If the SCOPE is itself a TYPENAME_TYPE, then we need to resolve
      it first before we can figure out what NAME refers to.  */
   if (TREE_CODE (scope) == TYPENAME_TYPE)
-    scope = resolve_typename_type (scope, only_current_p);
+    {
+      if (TYPENAME_IS_RESOLVING_P (scope))
+	/* Given a class template A with a dependent base with nested type C,
+	   typedef typename A::C::C C will land us here, as trying to resolve
+	   the initial A::C leads to the local C typedef, which leads back to
+	   A::C::C.  So we break the recursion now.  */
+	return type;
+      else
+	scope = resolve_typename_type (scope, only_current_p);
+    }
   /* If we don't know what SCOPE refers to, then we cannot resolve the
      TYPENAME_TYPE.  */
   if (TREE_CODE (scope) == TYPENAME_TYPE)
Index: gcc/cp/semantics.c
===================================================================
--- a/src/gcc/cp/semantics.c	(revision
+++ b/src/gcc/cp/semantics.c	(revision
@@ -9311,6 +9311,8 @@
   DECL_NOT_REALLY_EXTERN (fn) = 1;
   DECL_DECLARED_INLINE_P (fn) = 1;
   DECL_ARGUMENTS (fn) = build_this_parm (fntype, TYPE_QUAL_CONST);
+  if (nested)
+    DECL_INTERFACE_KNOWN (fn) = 1;
 
   add_method (type, fn, NULL_TREE);
 
@@ -9341,6 +9343,8 @@
   DECL_ARGUMENTS (fn) = copy_list (DECL_CHAIN (DECL_ARGUMENTS (callop)));
   for (arg = DECL_ARGUMENTS (fn); arg; arg = DECL_CHAIN (arg))
     DECL_CONTEXT (arg) = fn;
+  if (nested)
+    DECL_INTERFACE_KNOWN (fn) = 1;
 
   add_method (type, fn, NULL_TREE);
 
Index: gcc/cp/decl2.c
===================================================================
--- a/src/gcc/cp/decl2.c	(revision
+++ b/src/gcc/cp/decl2.c	(revision
@@ -1929,16 +1929,15 @@
     {
       *walk_subtrees = 0;
     }
-  else if (CLASS_TYPE_P (*tp))
+  else if (TAGGED_TYPE_P (*tp)
+	   && !TREE_PUBLIC (TYPE_MAIN_DECL (*tp)))
     {
-      if (!TREE_PUBLIC (TYPE_MAIN_DECL (*tp)))
-	{
-	  *vis_p = VISIBILITY_ANON;
-	  return *tp;
-	}
-      else if (CLASSTYPE_VISIBILITY (*tp) > *vis_p)
-	*vis_p = CLASSTYPE_VISIBILITY (*tp);
+      *vis_p = VISIBILITY_ANON;
+      return *tp;
     }
+  else if (CLASS_TYPE_P (*tp)
+	   && CLASSTYPE_VISIBILITY (*tp) > *vis_p)
+    *vis_p = CLASSTYPE_VISIBILITY (*tp);
   return NULL;
 }
 
Index: gcc/cp/parser.c
===================================================================
--- a/src/gcc/cp/parser.c	(revision
+++ b/src/gcc/cp/parser.c	(revision
@@ -17666,11 +17666,14 @@
 	  /* In C++11, [ could start a lambda-introducer.  */
 	  cp_parser_parse_tentatively (parser);
 	  cp_lexer_consume_token (parser->lexer);
-	  designator = cp_parser_constant_expression (parser, false, NULL);
+	  bool non_const = false;
+	  designator = cp_parser_constant_expression (parser, true, &non_const);
 	  cp_parser_require (parser, CPP_CLOSE_SQUARE, RT_CLOSE_SQUARE);
 	  cp_parser_require (parser, CPP_EQ, RT_EQ);
 	  if (!cp_parser_parse_definitely (parser))
 	    designator = NULL_TREE;
+	  else if (non_const)
+	    require_potential_rvalue_constant_expression (designator);
 	}
       else
 	designator = NULL_TREE;
Index: gcc/ada/exp_attr.adb
===================================================================
--- a/src/gcc/ada/exp_attr.adb	(revision
+++ b/src/gcc/ada/exp_attr.adb	(revision
@@ -2996,9 +2996,26 @@
       -- Max_Size_In_Storage_Elements --
       ----------------------------------
 
-      when Attribute_Max_Size_In_Storage_Elements =>
+      when Attribute_Max_Size_In_Storage_Elements => declare
+         Typ  : constant Entity_Id := Etype (N);
+         Attr : Node_Id;
+
+         Conversion_Added : Boolean := False;
+         --  A flag which tracks whether the original attribute has been
+         --  wrapped inside a type conversion.
+
+      begin
          Apply_Universal_Integer_Attribute_Checks (N);
 
+         --  The universal integer check may sometimes add a type conversion,
+         --  retrieve the original attribute reference from the expression.
+
+         Attr := N;
+         if Nkind (Attr) = N_Type_Conversion then
+            Attr := Expression (Attr);
+            Conversion_Added := True;
+         end if;
+
          --  Heap-allocated controlled objects contain two extra pointers which
          --  are not part of the actual type. Transform the attribute reference
          --  into a runtime expression to add the size of the hidden header.
@@ -3007,20 +3024,20 @@
          --  two pointers are already present in the type.
 
          if VM_Target = No_VM
-           and then Nkind (N) = N_Attribute_Reference
+           and then Nkind (Attr) = N_Attribute_Reference
            and then Needs_Finalization (Ptyp)
-           and then not Header_Size_Added (N)
+           and then not Header_Size_Added (Attr)
          then
-            Set_Header_Size_Added (N);
+            Set_Header_Size_Added (Attr);
 
             --  Generate:
             --    P'Max_Size_In_Storage_Elements +
             --      Universal_Integer
             --        (Header_Size_With_Padding (Ptyp'Alignment))
 
-            Rewrite (N,
+            Rewrite (Attr,
               Make_Op_Add (Loc,
-                Left_Opnd  => Relocate_Node (N),
+                Left_Opnd  => Relocate_Node (Attr),
                 Right_Opnd =>
                   Convert_To (Universal_Integer,
                     Make_Function_Call (Loc,
@@ -3034,9 +3051,19 @@
                             New_Reference_To (Ptyp, Loc),
                           Attribute_Name => Name_Alignment))))));
 
-            Analyze (N);
+            --  Add a conversion to the target type
+
+            if not Conversion_Added then
+               Rewrite (Attr,
+                 Make_Type_Conversion (Loc,
+                   Subtype_Mark => New_Reference_To (Typ, Loc),
+                   Expression   => Relocate_Node (Attr)));
+            end if;
+
+            Analyze (Attr);
             return;
          end if;
+      end;
 
       --------------------
       -- Mechanism_Code --
Index: gcc/ada/ChangeLog
===================================================================
--- a/src/gcc/ada/ChangeLog	(revision
+++ b/src/gcc/ada/ChangeLog	(revision
@@ -1,3 +1,27 @@
+2012-12-16  Eric Botcazou  <ebotcazou@adacore.com>
+
+	PR ada/54614
+	Backport from mainline
+
+	2012-10-01  Vincent Pucci  <pucci@adacore.com>
+
+	* s-gearop.adb (Vector_Matrix_Product): Fix dimension check and index
+	of Left in S evaluation.
+
+2012-12-15  Eric Botcazou  <ebotcazou@adacore.com>
+
+	PR ada/53766
+	Backport from mainline
+
+	2012-07-17  Hristian Kirtchev  <kirtchev@adacore.com>
+
+	* exp_attr.adb (Expand_N_Attribute_Reference): Add local variables Attr
+	and Conversion_Added.  Add local constant Typ.
+	Retrieve the original attribute after the arithmetic check
+	machinery has modified the node. Add a conversion to the target
+	type when the prefix of attribute Max_Size_In_Storage_Elements
+	is a controlled type.
+
 2012-12-01  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>
 
 	PR ada/52110
Index: gcc/ada/s-gearop.adb
===================================================================
--- a/src/gcc/ada/s-gearop.adb	(revision
+++ b/src/gcc/ada/s-gearop.adb	(revision
@@ -924,7 +924,7 @@
       R : Result_Vector (Right'Range (2));
 
    begin
-      if Left'Length /= Right'Length (2) then
+      if Left'Length /= Right'Length (1) then
          raise Constraint_Error with
            "incompatible dimensions in vector-matrix multiplication";
       end if;
@@ -935,7 +935,7 @@
 
          begin
             for K in Right'Range (1) loop
-               S := S + Left (J - Right'First (1) + Left'First) * Right (K, J);
+               S := S + Left (K - Right'First (1) + Left'First) * Right (K, J);
             end loop;
 
             R (J) := S;
Index: gcc/print-tree.c
===================================================================
--- a/src/gcc/print-tree.c	(revision
+++ b/src/gcc/print-tree.c	(revision
@@ -255,7 +255,7 @@
   /* Allow this function to be called if the table is not there.  */
   if (table)
     {
-      hash = ((unsigned long) node) % HASH_SIZE;
+      hash = ((uintptr_t) node) % HASH_SIZE;
 
       /* If node is in the table, just mention its address.  */
       for (b = table[hash]; b; b = b->next)
Index: gcc/config/sparc/sparc.md
===================================================================
--- a/src/gcc/config/sparc/sparc.md	(revision
+++ b/src/gcc/config/sparc/sparc.md	(revision
@@ -7531,7 +7531,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:SI 1 "register_operand" "r")))
-	(match_operand:QI 0 "register_operand" "=r"))]
+	(match_operand:QI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH32"
   "stb\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7541,7 +7541,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:DI 1 "register_operand" "r")))
-	(match_operand:QI 0 "register_operand" "=r"))]
+	(match_operand:QI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH64"
   "stb\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7551,7 +7551,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:SI 1 "register_operand" "r")))
-	(match_operand:HI 0 "register_operand" "=r"))]
+	(match_operand:HI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH32"
   "sth\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7561,7 +7561,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:DI 1 "register_operand" "r")))
-	(match_operand:HI 0 "register_operand" "=r"))]
+	(match_operand:HI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH64"
   "sth\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7571,7 +7571,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:SI 1 "register_operand" "r")))
-	(match_operand:SI 0 "register_operand" "=r"))]
+	(match_operand:SI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH32"
   "st\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7581,7 +7581,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:DI 1 "register_operand" "r")))
-	(match_operand:SI 0 "register_operand" "=r"))]
+	(match_operand:SI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH64"
   "stw\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
@@ -7591,7 +7591,7 @@
 				     (match_operand 3 "tld_symbolic_operand" "")]
 				    UNSPEC_TLSLDO)
 			 (match_operand:DI 1 "register_operand" "r")))
-	(match_operand:DI 0 "register_operand" "=r"))]
+	(match_operand:DI 0 "register_operand" "r"))]
   "TARGET_TLS && TARGET_ARCH64"
   "stx\t%0, [%1 + %2], %%tldo_add(%3)"
   [(set_attr "type" "store")])
Index: gcc/config/sparc/sync.md
===================================================================
--- a/src/gcc/config/sparc/sync.md	(revision
+++ b/src/gcc/config/sparc/sync.md	(revision
@@ -35,8 +35,7 @@
 
 (define_expand "membar"
   [(set (match_dup 1)
-	(unspec:BLK [(match_dup 1)
-		     (match_operand:SI 0 "const_int_operand")]
+	(unspec:BLK [(match_dup 1) (match_operand:SI 0 "const_int_operand")]
 		    UNSPEC_MEMBAR))]
   "TARGET_V8 || TARGET_V9"
 {
@@ -66,7 +65,7 @@
   "stbar"
   [(set_attr "type" "multi")])
 
-;; For V8, LDSTUB has the effect of membar #StoreLoad
+;; For V8, LDSTUB has the effect of membar #StoreLoad.
 (define_insn "*membar_storeload"
   [(set (match_operand:BLK 0 "" "")
 	(unspec:BLK [(match_dup 0) (const_int 2)] UNSPEC_MEMBAR))]
@@ -123,8 +122,8 @@
   [(set_attr "type" "load,fpload")])
 
 (define_expand "atomic_store<mode>"
-  [(match_operand:I 0 "register_operand" "")
-   (match_operand:I 1 "memory_operand" "")
+  [(match_operand:I 0 "memory_operand" "")
+   (match_operand:I 1 "register_operand" "")
    (match_operand:SI 2 "const_int_operand" "")]
   ""
 {
Index: gcc/config/sparc/sparc.c
===================================================================
--- a/src/gcc/config/sparc/sparc.c	(revision
+++ b/src/gcc/config/sparc/sparc.c	(revision
@@ -10949,26 +10949,26 @@
 
   if (before_after & 1)
     {
-      if (model == MEMMODEL_ACQUIRE
-          || model == MEMMODEL_ACQ_REL
-          || model == MEMMODEL_SEQ_CST)
+      if (model == MEMMODEL_RELEASE
+	  || model == MEMMODEL_ACQ_REL
+	  || model == MEMMODEL_SEQ_CST)
 	{
 	  if (load_store & 1)
-	    mm |= LoadLoad | LoadStore;
+	    mm |= LoadLoad | StoreLoad;
 	  if (load_store & 2)
-	    mm |= StoreLoad | StoreStore;
+	    mm |= LoadStore | StoreStore;
 	}
     }
   if (before_after & 2)
     {
-      if (model == MEMMODEL_RELEASE
+      if (model == MEMMODEL_ACQUIRE
 	  || model == MEMMODEL_ACQ_REL
 	  || model == MEMMODEL_SEQ_CST)
 	{
 	  if (load_store & 1)
-	    mm |= LoadLoad | StoreLoad;
+	    mm |= LoadLoad | LoadStore;
 	  if (load_store & 2)
-	    mm |= LoadStore | StoreStore;
+	    mm |= StoreLoad | StoreStore;
 	}
     }
 
Index: gcc/config/i386/i386.c
===================================================================
--- a/src/gcc/config/i386/i386.c	(revision
+++ b/src/gcc/config/i386/i386.c	(revision
@@ -12675,6 +12675,9 @@
 	  tp = get_thread_pointer (true);
 	  dest = force_reg (Pmode, gen_rtx_PLUS (Pmode, tp, dest));
 
+	  if (GET_MODE (x) != Pmode)
+	    x = gen_rtx_ZERO_EXTEND (Pmode, x);
+
 	  set_unique_reg_note (get_last_insn (), REG_EQUAL, x);
 	}
       else
@@ -12683,13 +12686,17 @@
 
 	  if (TARGET_64BIT)
 	    {
-	      rtx rax = gen_rtx_REG (Pmode, AX_REG), insns;
+	      rtx rax = gen_rtx_REG (Pmode, AX_REG);
+	      rtx insns;
 
 	      start_sequence ();
 	      emit_call_insn (gen_tls_global_dynamic_64 (rax, x, caddr));
 	      insns = get_insns ();
 	      end_sequence ();
 
+	      if (GET_MODE (x) != Pmode)
+		x = gen_rtx_ZERO_EXTEND (Pmode, x);
+
 	      RTL_CONST_CALL_P (insns) = 1;
 	      emit_libcall_block (insns, dest, rax, x);
 	    }
@@ -12731,7 +12738,8 @@
 
 	  if (TARGET_64BIT)
 	    {
-	      rtx rax = gen_rtx_REG (Pmode, AX_REG), insns, eqv;
+	      rtx rax = gen_rtx_REG (Pmode, AX_REG);
+	      rtx insns, eqv;
 
 	      start_sequence ();
 	      emit_call_insn (gen_tls_local_dynamic_base_64 (rax, caddr));
@@ -12759,6 +12767,9 @@
 	{
 	  dest = force_reg (Pmode, gen_rtx_PLUS (Pmode, dest, tp));
 
+	  if (GET_MODE (x) != Pmode)
+	    x = gen_rtx_ZERO_EXTEND (Pmode, x);
+
 	  set_unique_reg_note (get_last_insn (), REG_EQUAL, x);
 	}
       break;
Index: gcc/config/pa/pa.md
===================================================================
--- a/src/gcc/config/pa/pa.md	(revision
+++ b/src/gcc/config/pa/pa.md	(revision
@@ -5341,7 +5341,7 @@
   "* return pa_output_mul_insn (0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_insn ""
@@ -5354,7 +5354,7 @@
   "* return pa_output_mul_insn (0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_expand "muldi3"
@@ -5447,7 +5447,7 @@
    return pa_output_div_insn (operands, 0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_insn ""
@@ -5463,7 +5463,7 @@
    return pa_output_div_insn (operands, 0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_expand "udivsi3"
@@ -5508,7 +5508,7 @@
    return pa_output_div_insn (operands, 1, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_insn ""
@@ -5524,7 +5524,7 @@
    return pa_output_div_insn (operands, 1, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_expand "modsi3"
@@ -5565,7 +5565,7 @@
   return pa_output_mod_insn (0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_insn ""
@@ -5580,7 +5580,7 @@
   return pa_output_mod_insn (0, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_expand "umodsi3"
@@ -5621,7 +5621,7 @@
   return pa_output_mod_insn (1, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 (define_insn ""
@@ -5636,7 +5636,7 @@
   return pa_output_mod_insn (1, insn);"
   [(set_attr "type" "milli")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_millicode_call (insn)")))])
 
 ;;- and instructions
@@ -7214,7 +7214,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 (define_insn "call_symref_pic"
@@ -7293,7 +7293,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -7380,7 +7380,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 (define_insn "call_reg"
@@ -7396,7 +7396,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -7476,7 +7476,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -7562,7 +7562,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 12)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 12)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 (define_expand "call_value"
@@ -7690,7 +7690,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 (define_insn "call_val_symref_pic"
@@ -7775,7 +7775,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -7868,7 +7868,7 @@
 }"
   [(set_attr "type" "call")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 0)")))])
 
 (define_insn "call_val_reg"
@@ -7885,7 +7885,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -7971,7 +7971,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 ;; This pattern is split if it is necessary to save and restore the
@@ -8063,7 +8063,7 @@
 }"
   [(set_attr "type" "dyncall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 12)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 12)]
 	      (symbol_ref "pa_attr_length_indirect_call (insn)")))])
 
 ;; Call subroutine returning any type.
@@ -8159,7 +8159,7 @@
 }"
   [(set_attr "type" "sibcall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 1)")))])
 
 (define_insn "sibcall_internal_symref_64bit"
@@ -8176,7 +8176,7 @@
 }"
   [(set_attr "type" "sibcall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 1)")))])
 
 (define_expand "sibcall_value"
@@ -8247,7 +8247,7 @@
 }"
   [(set_attr "type" "sibcall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 1)")))])
 
 (define_insn "sibcall_value_internal_symref_64bit"
@@ -8265,7 +8265,7 @@
 }"
   [(set_attr "type" "sibcall")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 8)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 8)]
 	      (symbol_ref "pa_attr_length_call (insn, 1)")))])
 
 (define_insn "nop"
@@ -9304,7 +9304,7 @@
 }"
   [(set_attr "type" "sh_func_adrs")
    (set (attr "length")
-	(cond [(and (match_test "0") (eq (const_int 0) (pc))) (const_int 28)]
+	(cond [(and (const_int 0) (eq (const_int 0) (pc))) (const_int 28)]
 	      (plus (symbol_ref "pa_attr_length_millicode_call (insn)")
 		    (const_int 20))))])
 
