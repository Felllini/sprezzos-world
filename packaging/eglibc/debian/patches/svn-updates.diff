SVN update of svn://svn.eglibc.org/branches/eglibc-2_16 from revision 21208

Index: NEWS
===================================================================
--- a/NEWS	(revision 21208)
+++ b/NEWS	(revision 21808)
@@ -9,7 +9,7 @@
 
 * The following bugs are resolved with this release:
 
-  6530, 14195, 14459, 14476, 14562, 14621, 14648
+  6530, 14195, 14459, 14476, 14562, 14621, 14648, 14756, 14809
 
 Version 2.16
 
Index: ChangeLog
===================================================================
--- a/ChangeLog	(revision 21208)
+++ b/ChangeLog	(revision 21808)
@@ -1,3 +1,11 @@
+2012-11-07  Andreas Jaeger  <aj@suse.de>
+
+	[BZ #14809]
+	* sysdeps/unix/sysv/linux/sys/sysctl.h (_UAPI_LINUX_KERNEL_H)
+	(_UAPI_LINUX_TYPES_H): Starting with Linux 3.7, the include header
+	guards are changed.  Only define if not yet defined, #undef back
+	after including linux/sysctl.h if defined here.
+
 2012-10-04  H.J. Lu  <hongjiu.lu@intel.com>
 
 	[BZ #14648]
@@ -16,6 +24,15 @@
 	* stdio-common/vfprintf.c (process_string_arg): Revert
 	2000-07-22 change.
 
+2012-07-06  Andreas Schwab  <schwab@linux-m68k.org>
+
+	[BZ #14042]
+	* sysdeps/powerpc/powerpc32/ppc-mcount.S [SHARED]: Don't use PLT
+	for call to __mcount_internal.
+	* sysdeps/powerpc/powerpc32/Makefile (sysdep_routines)
+	(shared-only-routines) [$(subdir) = gmon]: Add compat-ppc-mcount.
+	* sysdeps/powerpc/powerpc32/compat-ppc-mcount.S: New file.
+
 2011-09-28  Jonathan Nieder  <jrnieder@gmail.com>
 
 	* stdio-common/Makefile (tst-sprintf-ENV): Set environment
Index: sysdeps/powerpc/powerpc32/Makefile
===================================================================
--- a/sysdeps/powerpc/powerpc32/Makefile	(revision 21208)
+++ b/sysdeps/powerpc/powerpc32/Makefile	(revision 21808)
@@ -6,8 +6,9 @@
 endif
 
 ifeq ($(subdir),gmon)
-sysdep_routines += ppc-mcount
+sysdep_routines += ppc-mcount compat-ppc-mcount
 static-only-routines += ppc-mcount
+shared-only-routines += compat-ppc-mcount
 endif
 
 ifeq ($(subdir),misc)
Index: sysdeps/powerpc/powerpc32/ppc-mcount.S
===================================================================
--- a/sysdeps/powerpc/powerpc32/ppc-mcount.S	(revision 21208)
+++ b/sysdeps/powerpc/powerpc32/ppc-mcount.S	(revision 21808)
@@ -1,5 +1,5 @@
 /* PowerPC-specific implementation of profiling support.
-   Copyright (C) 1997, 1999, 2005, 2006 Free Software Foundation, Inc.
+   Copyright (C) 1997-2012 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -57,7 +57,11 @@
 	stw	r4, 44(r1)
 	cfi_offset (lr, -4)
 	stw	r5,  8(r1)
+#ifndef SHARED
 	bl	JUMPTARGET(__mcount_internal)
+#else
+	bl	__mcount_internal@local
+#endif
  /* Restore the registers...  */
 	lwz     r6,  8(r1)
 	lwz	r0, 44(r1)
Index: sysdeps/powerpc/powerpc32/compat-ppc-mcount.S
===================================================================
--- a/sysdeps/powerpc/powerpc32/compat-ppc-mcount.S	(revision 0)
+++ b/sysdeps/powerpc/powerpc32/compat-ppc-mcount.S	(revision 21808)
@@ -0,0 +1,11 @@
+#include <shlib-compat.h>
+
+#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_15)
+
+	compat_text_section
+# define _mcount __compat_mcount
+# include "ppc-mcount.S"
+# undef _mcount
+
+compat_symbol (libc, __compat_mcount, _mcount, GLIBC_2_0)
+#endif
Index: sysdeps/unix/sysv/linux/sys/sysctl.h
===================================================================
--- a/sysdeps/unix/sysv/linux/sys/sysctl.h	(revision 21208)
+++ b/sysdeps/unix/sysv/linux/sys/sysctl.h	(revision 21808)
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1999, 2002, 2003, 2004 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2012 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -39,6 +39,14 @@
 # define __user
 # define __undef__LINUX_COMPILER_H
 #endif
+#ifndef  _UAPI_LINUX_KERNEL_H
+# define _UAPI_LINUX_KERNEL_H
+# define __undef_UAPI_LINUX_KERNEL_H
+#endif
+#ifndef _UAPI_LINUX_TYPES_H
+# define _UAPI_LINUX_TYPES_H
+# define __undef_UAPI_LINUX_TYPES_H
+#endif
 
 #include <linux/sysctl.h>
 
@@ -59,6 +67,14 @@
 # undef __user
 # undef __undef__LINUX_COMPILER_H
 #endif
+#ifdef  __undef_UAPI_LINUX_KERNEL_H
+# undef _UAPI_LINUX_KERNEL_H
+# undef __undef_UAPI_LINUX_KERNEL_H
+#endif
+#ifdef __undef_UAPI_LINUX_TYPES_H
+# undef _UAPI_LINUX_TYPES_H
+# undef __undef_UAPI_LINUX_TYPES_H
+#endif
 
 #include <bits/sysctl.h>
 
