#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

override_dh_auto_configure:
	mkdir debian/build
	cd debian/build && ../../configure --prefix=/usr \
		--libdir=/lib/x86_64-linux-gnu --enable-multiarch

override_dh_auto_build:
	$(MAKE) -C debian/build

override_dh_auto_install:
	$(MAKE) -C debian/build install DESTDIR=$(shell pwd)/debian/tmp

override_dh_install:
	rm debian/tmp/etc/rpc # conflicts with netbase 5.1 FIXME
	rm debian/tmp/usr/share/info/dir
	# conflicts with xtrace, is not same!
	mv debian/tmp/usr/bin/xtrace debian/tmp/usr/bin/xtrace-glibc
	chmod 755 $(wildcard debian/tmp/lib64/*so)
	mv debian/tmp/lib64/lib* debian/tmp/lib/x86_64-linux-gnu
	for i in debian/tmp/lib/*/*.so ; do ln -sf $(shell basename $(shell readname -n $$i)) $$i ; done
	dh_install --fail-missing

%:
	dh $@
