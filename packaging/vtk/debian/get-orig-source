#!/bin/sh

PACKAGE=vtk

VERSION=${VERSION:-$2}
TARFILE=${TARFILE:-$3}

if [ -z ${VERSION}]; then
VERSION=`dpkg-parsechangelog | sed -n -e 's/^Version: \(.*\)-[^-]*$/\1/p'`
fi

REVISION=`echo $VERSION | sed -e 's/^.*git//g'`


if [ -z ${TARFILE}]; then
TARFILE=${PACKAGE}_${VERSION}.orig.tar.gz
fi

FOLDER=${PACKAGE}-${VERSION}

# as of 17 Oct 2012, tag v5.10.1 points to commit id c729c7982475a91be49713e2ccc1852990a9bc68
git clone git://vtk.org/VTK.git $FOLDER
cd $FOLDER
git checkout $REVISION
rm -rf .git
cd ..
GZIP="--best --no-name" tar cfz $TARFILE $FOLDER
