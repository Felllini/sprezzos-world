Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 blender (2.65a-SprezzOS1) unstable; urgency=low
 .
   * Build against libOpenImageIO
   * New upstream 2.65a
Author: Nick Black <nick.black@sprezzatech.com>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: http://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: <YYYY-MM-DD>

--- blender-2.65a.orig/intern/audaspace/ffmpeg/AUD_FFMPEGWriter.cpp
+++ blender-2.65a/intern/audaspace/ffmpeg/AUD_FFMPEGWriter.cpp
@@ -53,7 +53,7 @@ AUD_FFMPEGWriter::AUD_FFMPEGWriter(std::
 	m_specs(specs),
 	m_input_samples(0)
 {
-	static const char* formats[] = { NULL, "ac3", "flac", "matroska", "mp2", "mp3", "ogg", "wav" };
+	//static const char* formats[] = { NULL, "ac3", "flac", "matroska", "mp2", "mp3", "ogg", "wav" };
 
 	if(avformat_open_input(&m_formatCtx, filename.c_str(), NULL, NULL))
 		AUD_THROW(AUD_ERROR_FFMPEG, context_error);
@@ -116,7 +116,7 @@ AUD_FFMPEGWriter::AUD_FFMPEGWriter(std::
 		if(m_outputFmt->audio_codec == CODEC_ID_NONE)
 			AUD_THROW(AUD_ERROR_SPECS, codec_error);
 
-		m_stream = av_new_stream(m_formatCtx, 0);
+		m_stream = avformat_new_stream(m_formatCtx, 0);
 		if(!m_stream)
 			AUD_THROW(AUD_ERROR_FFMPEG, stream_error);
 
@@ -164,7 +164,7 @@ AUD_FFMPEGWriter::AUD_FFMPEGWriter(std::
 			if(!codec)
 				AUD_THROW(AUD_ERROR_FFMPEG, codec_error);
 
-			if(avcodec_open(m_codecCtx, codec))
+			if(avcodec_open2(m_codecCtx, codec, NULL))
 				AUD_THROW(AUD_ERROR_FFMPEG, codec_error);
 
 			m_output_buffer.resize(FF_MIN_BUFFER_SIZE);
