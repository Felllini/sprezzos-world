From 28cb7b7e1bdf2213c4b980d52b03dd5762f39214 Mon Sep 17 00:00:00 2001
From: "Sergey V. Udaltsov" <svu@gnome.org>
Date: Tue, 21 Feb 2012 21:44:06 +0000
Subject: [PATCH] Explicitly exporting only the symbols that are really
 required

https://bugs.freedesktop.org/show_bug.cgi?id=46416
---
 libxklavier/Makefile.am        |    4 +-
 libxklavier/libxklavier.public |   91 ++++++++++++++++++++++++++++++++++++++++
 2 files changed, 93 insertions(+), 2 deletions(-)
 create mode 100644 libxklavier/libxklavier.public

diff --git a/libxklavier/Makefile.am b/libxklavier/Makefile.am
index c53ff6d..63c5d8d 100644
--- a/libxklavier/Makefile.am
+++ b/libxklavier/Makefile.am
@@ -37,13 +37,13 @@ libxklavier_la_SOURCES = $(xklavier_built_cfiles) xklavier.c xklavier_evt.c xkla
 	xklavier_xmm.c xklavier_xmm_opts.c xklavier_evt_xmm.c xklavier_config_xmm.c \
 	xklavier_util.c xklavier_props.c xklavier_dump.c xkl_engine_marshal.c \
 	$(noinst_HEADERS) $(xklavierinc_HEADERS) 
-libxklavier_la_LDFLAGS = -version-info @VERSION_INFO@ -no-undefined
+libxklavier_la_LDFLAGS = -version-info @VERSION_INFO@ -no-undefined -export-symbols $(srcdir)/libxklavier.public
 libxklavier_la_LIBADD = \
  $(XML_LIBS) $(GLIB_LIBS) $(XINPUT_LIBS) \
  $(LIBXKBFILE_PRESENT_LDFLAGS) \
  $(X_LIBS) -lX11 $(LIBICONV) 
 
-EXTRA_DIST=marshal.list
+EXTRA_DIST=marshal.list libxklavier.public
 
 GLIB_GENMARSHAL = `$PKG_CONFIG --variable=glib_genmarshal glib-2.0`
 
diff --git a/libxklavier/libxklavier.public b/libxklavier/libxklavier.public
new file mode 100644
index 0000000..ae5c5b8
--- /dev/null
+++ b/libxklavier/libxklavier.public
@@ -0,0 +1,91 @@
+xkl_config_item_get_type
+xkl_config_item_new
+xkl_config_item_set_description
+xkl_config_item_set_name
+xkl_config_item_set_short_description
+xkl_config_rec_activate
+xkl_config_rec_dump
+xkl_config_rec_equals
+xkl_config_rec_get_from_backup
+xkl_config_rec_get_from_root_window_property
+xkl_config_rec_get_from_server
+xkl_config_rec_get_type
+xkl_config_rec_new
+xkl_config_rec_reset
+xkl_config_rec_set_layouts
+xkl_config_rec_set_options
+xkl_config_rec_set_to_root_window_property
+xkl_config_rec_set_variants
+xkl_config_rec_write_to_file
+xkl_config_registry_find_layout
+xkl_config_registry_find_model
+xkl_config_registry_find_option
+xkl_config_registry_find_option_group
+xkl_config_registry_find_variant
+xkl_config_registry_foreach_country
+xkl_config_registry_foreach_country_variant
+xkl_config_registry_foreach_language
+xkl_config_registry_foreach_language_variant
+xkl_config_registry_foreach_layout
+xkl_config_registry_foreach_layout_variant
+xkl_config_registry_foreach_model
+xkl_config_registry_foreach_option
+xkl_config_registry_foreach_option_group
+xkl_config_registry_get_instance
+xkl_config_registry_get_type
+xkl_config_registry_load
+xkl_config_registry_search_by_pattern
+_xkl_debug
+xkl_default_log_appender
+xkl_engine_allow_one_switch_to_secondary_group
+xkl_engine_backup_names_prop
+xkl_engine_delete_state
+xkl_engine_features_get_type
+xkl_engine_filter_events
+xkl_engine_get_backend_name
+xkl_engine_get_current_state
+xkl_engine_get_current_window
+xkl_engine_get_current_window_group
+xkl_engine_get_default_group
+xkl_engine_get_features
+xkl_engine_get_groups_names
+xkl_engine_get_indicators_handling
+xkl_engine_get_indicators_names
+xkl_engine_get_instance
+xkl_engine_get_max_num_groups
+xkl_engine_get_next_group
+xkl_engine_get_num_groups
+xkl_engine_get_prev_group
+xkl_engine_get_secondary_groups_mask
+xkl_engine_get_state
+xkl_engine_get_type
+xkl_engine_get_window_title
+xkl_engine_grab_key
+xkl_engine_INT__LONG_LONG
+xkl_engine_is_group_per_toplevel_window
+xkl_engine_is_window_from_same_toplevel_window
+xkl_engine_is_window_transparent
+xkl_engine_listen_modes_get_type
+xkl_engine_lock_group
+xkl_engine_pause_listen
+xkl_engine_resume_listen
+xkl_engine_save_state
+xkl_engine_set_default_group
+xkl_engine_set_group_per_toplevel_window
+xkl_engine_set_indicators_handling
+xkl_engine_set_secondary_groups_mask
+xkl_engine_set_window_transparent
+xkl_engine_start_listen
+xkl_engine_state_change_get_type
+xkl_engine_stop_listen
+xkl_engine_ungrab_key
+xkl_engine_VOID__FLAGS_INT_BOOLEAN
+xkl_get_country_name
+xkl_get_language_name
+xkl_get_last_error
+xkl_restore_names_prop
+xkl_set_debug_level
+xkl_set_log_appender
+xkl_state_get_type
+xkl_xkb_config_native_cleanup
+xkl_xkb_config_native_prepare
-- 
1.7.9.1

