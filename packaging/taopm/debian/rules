#!/usr/bin/make -f

# TODO: multiarch - needs some hacks in upstream code
DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

%:
	dh $@

override_dh_auto_configure:
	dh_auto_configure -- TAODIR=/usr/lib/$(DEB_HOST_MULTIARCH)/taopm
override_dh_auto_clean:
	dh_auto_clean
	rm -f libtao/*.loT config.status.lineno
override_dh_install:
	dh_install --list-missing
	#Drop content of dependency_libs
	for file in $(CURDIR)/debian/taopm/usr/lib/$(DEB_HOST_MULTIARCH)/*.la; do \
	        sed -i "/dependency_libs/ s/'.*'/''/" $$file ; \
	done
override_dh_fixperms:
	dh_fixperms
	chmod 644 debian/taopm/usr/share/doc/taopm/examples/* \
                  debian/taopm/usr/lib/$(DEB_HOST_MULTIARCH)/taopm/include/* \
                  debian/taopm/usr/lib/$(DEB_HOST_MULTIARCH)/taopm/user-scripts/error.parse
