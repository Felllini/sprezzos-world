#!/usr/bin/make -f
# Sample debian/rules that uses debhelper.
# GNU copyright 1997 to 1999 by Joey Hess.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# This is the debhelper compatability version to use.
#export DH_COMPAT=4

DEB_HOST_ARCH_CPU  ?= $(shell dpkg-architecture -qDEB_HOST_ARCH_CPU)
# for compatibility with sarge's dpkg-architecture
DEB_HOST_ARCH_CPU  ?= $(shell dpkg-architecture -qDEB_HOST_ARCH)

CXXFLAGS = -g -Wall

ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
CXXFLAGS += -O0
else
	ifeq ($(DEB_HOST_ARCH_CPU),mips)
		CXXFLAGS += -O1
	else
		ifeq ($(DEB_HOST_ARCH_CPU),mipsel)
			CXXFLAGS += -O1
		else
			CXXFLAGS += -O2
		endif
	endif
endif

CFLAGS = $(CXXFLAGS)
export CXXFLAGS
export CFLAGS

configure: configure-stamp
configure-stamp:
	dh_testdir
	# Add here commands to configure the package.
	./configure --prefix=/ --mandir=\$${prefix}/usr/share/man --infodir=\$${prefix}/usr/share/info --bindir=\$${prefix}/usr/bin --sysconfdir=\$${prefix}/etc/kismet --datadir=\$${prefix}/usr/share --with-ethereal=wireshark --disable-suid-root --disable-setuid  --enable-wsp100

	touch configure-stamp

build: build-stamp

build-stamp: configure-stamp 
	dh_testdir

	# Add here commands to compile the package.
	#$(MAKE) CC=gcc-3.0
	#$(MAKE) CC=gcc-2.95  CXX=g++-2.95
	$(MAKE) 
	#/usr/bin/docbook-to-man debian/kismet.sgml > kismet.1

	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp configure-stamp libpcap-0.9.1-kis/net

	# Add here commands to clean up after the build process.
	-$(MAKE) distclean

	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	# Add here commands to install the package into debian/kismet.
	$(MAKE) install prefix=$(CURDIR)/debian/kismet


# Build architecture-independent files here.
binary-indep: build install
# We have nothing to do by default.

# Build architecture-dependent files here.
binary-arch: build install
	dh_testdir
	dh_testroot
#	dh_installdebconf	
	dh_installdocs
	dh_installexamples
	dh_installmenu
	dh_desktop
#	dh_installlogrotate
#	dh_installemacsen
#	dh_installpam
#	dh_installmime
#	dh_installinit
	dh_installcron
#	dh_installman debian/kismet.1 debian/kismet_server.1 debian/kismet_curses.1 debian/cisco_monitor.1 debian/cisco_unmonitor.1 debian/prism2_hopper.1 debian/prism2_monitor.1 debian/prism2_unmonitor.1
	dh_installman 
	dh_installinfo
#	dh_undocumented 

	dh_installchangelogs CHANGELOG
	dh_link
	dh_strip
#	find $(CURDIR)/debian/kismet -type d -name CVS -exec rm -rf {} \; 2>&1 > /dev/null
	dh_compress
	dh_fixperms
#	dh_makeshlibs
	dh_installdeb
#	dh_perl
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install configure
